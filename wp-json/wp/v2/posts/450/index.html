{"id":450,"date":"2018-05-03T10:55:39","date_gmt":"2018-05-03T05:55:39","guid":{"rendered":"http:\/\/18.139.242.7\/2018\/05\/03\/market-basket-analysis-of-ga-data-using-snowplow-and-r\/"},"modified":"2018-05-03T10:55:39","modified_gmt":"2018-05-03T05:55:39","slug":"market-basket-analysis-of-ga-data-using-snowplow-and-r","status":"publish","type":"post","link":"https:\/\/marketlytics.com\/blog\/market-basket-analysis-of-ga-data-using-snowplow-and-r\/","title":{"rendered":"Market Basket Analysis of GA data using Snowplow and R"},"content":{"rendered":"<p>Google Analytics is in many ways, a complete tool. From collecting data from your website, processing and aggregating it to giving you high-quality reports from which you can learn a great amount of things about your web data. The strength of Google Analytics lies primarily in its ease of use, with a few clicks here and there combined with a few copy pastes, we get our data spoon-fed to us.<\/p>\n<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/image4.gif\" alt=\" blackhole \" \/><\/p>\n<p><a href=\"https:\/\/marketlytics.com\/blog\/list-of-things-google-analytics-can-and-cannot-do\">Google Analytics is a great tool, but it does have its limitations<\/a>. Think of it as like a black hole, the version given to us by the movie Interstellar. You do not have the means to look inside it but what you can do is study it\u2019s radiations, these radiations in themself are quite useful but there\u2019s only so much you do with them. Here at MarketLytics, we are constantly on the lookout for new ways to get the most out of our clients data. With a tool like GA you can\u2019t actually access the raw data, or peer inside the black hole, as i\u2019d rather put it; unless you send data to BigQuery or another database there is limited room for innovation. This is where Snowplow \u00a0Analytics saves the day.<\/p>\n<p>Enter Snowplow Analytics, an open-source enterprise event-level analytics platform that enables data collection from multiple platforms for advanced data analytics.It is a lot similar to tools like Google Analytics 360 or Mixpanel, with one major difference; you can now access the hit-level raw data previously unattainable through traditional means.<\/p>\n<p>It is designed to work on Amazon Web Services, utilizing the power and scalability the cloud-based platform has to offer. One major downside of this paradigm is that for the relatively uninitiated, it is a headache to configure and get up and running. However, luckily for us, we came across <a href=\"https:\/\/www.simoahava.com\/analytics\/snowplow-full-setup-with-google-analytics-tracking\/\" target=\"_blank\" rel=\"noopener noreferrer\">this<\/a> detailed and a rather lengthy tutorial by Simo Ahava on duplicating Google Analytics data and sending it to our Snowplow setup.<\/p>\n<p>The tutorial is quite thorough and complete, If you haven\u2019t already set up and configured it to send your Google Analytics data, we recommend that you carefully comb through it. If at some point you get stuck, as we did countless times, just scroll up and make sure you did everything according to the blog. If you\u2019re still stuck, check the official documentation on Github or the Snowplow Community Forum on Discourse.<\/p>\n<h2><strong>Market Basket Analysis<\/strong><\/h2>\n<p>Now that we have Snowplow properly configured, it\u2019s time to extract some meaningful insights from it. For this tutorial, we shall be doing Market Basket Analysis (MBA), which is essentially a modeling technique based on the theory that if you buy a certain group of items you are more likely to buy another group of items. The end result is a set of rules that we can use to find out which items go together, this technique has a number of useful applications. E-commerce websites can now know what products they should place together to increase revenue, Content-focused websites can understand what content they should put in the same section or in close proximity.<\/p>\n<p><img decoding=\"async\" class=\"alignnone\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/19_image2.png\" alt=\" source: UofT \" \/> source: UofT<\/p>\n<p>In order to understand the mathematics behind MBA, you can read this <a href=\"https:\/\/webfocusinfocenter.informationbuilders.com\/wfappent\/TLs\/TL_rstat\/source\/marketbasket49.htm\" target=\"_blank\" rel=\"noopener noreferrer\">article<\/a><\/p>\n<p>MarketLytics is Digital Analytics consultancy and we run a blog which attracts a lot of traffic. Which again, isn\u2019t the ideal application for MBA but the steps shown below can be applied for E-commerce data as well.<\/p>\n<p>We are using R for this tutorial, if you\u2019re not familiar with the language then we recommend you hold on back on implementing this until you learn the basics.<\/p>\n<h3><strong>0) Installing the required packages<\/strong><\/h3>\n<p>We need to install the packages which we will need for this tutorial.<\/p>\n<pre class=\"source-code\">install.packages('tidyverse');\ninstall.packages('arules')\ninstall.packages('arulesViz')\ninstall.packages('dplyr')\ninstall.packages(\u2018RPostgreSQL\u2019)\n<\/pre>\n<p>Now load the respective packages using the library function.<\/p>\n<pre class=\"source-code\">library(tidyverse)\nlibrary(arules)\nlibrary(arulesViz)\nlibrary(dplyr)\nlibrary(RPostgreSQL)\n<\/pre>\n<h3><strong>1) Querying Redshift<\/strong><\/h3>\n<pre class=\"source-code\">library(RPostgreSQL)\n\ndrv <span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">-<\/span> <span class=\"cm-attribute\">dbDriver(<\/span><span class=\"cm-string cm-error\">\"PostgreSQL\"<\/span><span class=\"cm-attribute\">)<\/span>\n\n<span class=\"cm-attribute\">con<\/span> <span class=\"cm-tag cm-error\">&lt;- dbConnect(drv, <\/span>\n                 host=\"host.us-east-2.redshift.amazonaws.com\",\n                 port=\"5439\",\n                 dbname=\"dbname\",\n                 user=\"read_only\",\n                 password=\"###########\")\n<\/pre>\n<p>First we establish a connection with our Redshift DB using the RPostgreSQL library.<\/p>\n<pre class=\"source-code\">web_data <span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">-<\/span> <span class=\"cm-attribute\">dbGetQuery(con,<\/span>\n                      <span class=\"cm-string cm-error\">\"SELECT usr.client_id, ae.page_title, ae.geo_country, ae.collector_tstamp <\/span>\n                       <span class=\"cm-string cm-error\">FROM atomic.com_google_analytics_measurement_protocol_user_1 AS usr<\/span>\n                       <span class=\"cm-string cm-error\">JOIN atomic.events AS ae <\/span>\n                       <span class=\"cm-string cm-error\">ON usr.root_id = ae.event_id<\/span>\n                       <span class=\"cm-string cm-error\">ORDER BY ae.collector_tstamp DESC;\"<\/span><span class=\"cm-attribute\">)<\/span>\n<\/pre>\n<p>The query here is where all the magic is taking place, we are getting the data we would need for modeling. As mentioned before this is data from a blog and not an ecommerce site. For E-commerce data, we can use the following query.<\/p>\n<pre class=\"source-code\">SELECT usr.client_id, ae.ti_sku, ae.geo_country, ae.collector_tstamp\nFROM atomic.com_google_analytics_measurement_protocol_user_1 AS usr\nJOIN atomic.events AS ae \nON usr.root_id = ae.event_id\nORDER BY ae.collector_tstamp DESC;\n<\/pre>\n<p>Your query should return you a dataframe similar to the one shown below<\/p>\n<p><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/20_image1.png\" alt=\" dataframe \" \/><\/p>\n<h3><strong>2) Web Data ETL<\/strong><\/h3>\n<p>In order to bring this data into a format we can apply Market Basket Analysis to it, we need to put the data through a number of transformations<\/p>\n<pre class=\"source-code\">web_data$Date <span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">-<\/span> <span class=\"cm-attribute\">as.Date(web_data$collector_tstamp)<\/span>\n<span class=\"cm-attribute\">web_data<\/span> <span class=\"cm-tag cm-error\">&lt; web_data[complete.cases(web_data),]<\/span>\nweb_items <span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">-ddply(web_data,c(<\/span><span class=\"cm-string cm-error\">'client_id'<\/span><span class=\"cm-attribute\">,<\/span><span class=\"cm-string cm-error\">'Date'<\/span><span class=\"cm-attribute\">),<\/span>\n                 <span class=\"cm-attribute\">function(df1)paste(df1$page_title,<\/span>\n                                    <span class=\"cm-attribute\">collapse<\/span> = <span class=\"cm-string\">\",\"<\/span><span class=\"cm-attribute\">))<\/span>\n<span class=\"cm-attribute\">web_items$client_id<\/span> <span class=\"cm-tag cm-error\">&lt;-NULL<\/span>\nweb_items$Date <span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">-<\/span> <span class=\"cm-attribute\">NULL<\/span>\n<span class=\"cm-attribute\">colnames(web_items)<\/span> <span class=\"cm-tag cm-error\">&lt;- c('items')<\/span>\n<\/pre>\n<p>Once you\u2019ve successfully executed all these commands, your web_items dataframe should look something like this.<\/p>\n<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/6_image7.png\" alt=\" web items \" \/><\/p>\n<p>Now we will save this dataframe as a separate CSV<\/p>\n<p>write.csv(web_items,&#8221;web_basket.csv&#8221;,quote = FALSE, row.names = TRUE)<\/p>\n<h3><strong>3) Market Basket Analysis<\/strong><\/h3>\n<pre class=\"source-code\">web_tr <span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">-<\/span> <span class=\"cm-attribute\">read.transactions(<\/span><span class=\"cm-string cm-error\">\"web_basket.csv\"<\/span><span class=\"cm-attribute\">,format<\/span> = <span class=\"cm-string\">'basket'<\/span><span class=\"cm-attribute\">,sep<\/span> =<span class=\"cm-string\">','<\/span><span class=\"cm-attribute\">)<\/span>\n<span class=\"cm-attribute\">web_rules<\/span> <span class=\"cm-tag cm-error\">&lt;- apriori(web_tr,parameter = list(supp =0.001,conf =0.8))<\/span>\nweb_rules <span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">-<\/span> <span class=\"cm-attribute\">sort(web_rules,<\/span> <span class=\"cm-attribute\">by<\/span> =<span class=\"cm-string\">'confidence'<\/span><span class=\"cm-attribute\">,decreasing<\/span> = <span class=\"cm-string\">TRUE)<\/span>\n<\/pre>\n<p>In these lines of code, we load our CSV as a transaction, and then apply the apriori algorithm to find all the rules with minimum support of 0.001 and confidence above 0.8. We then arrange the rules in descending order of confidence.<\/p>\n<p>We can use the inspect() function to see our rules<\/p>\n<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/7_image5.png\" alt=\" inspect function \" \/><\/p>\n<p>The inspect tells us a number of useful things about our rules. In order to understand what this output means let&#8217;s pick the first rule and dissect it.<\/p>\n<p>Rule [1] tells us that we can say with a 100% confidence, that anybody who visits lhs \u2018Properties &amp; People &#8211; MarketLytics\u2019 page will also visit rhs \u2018Getting Started with Mixpanel: Events\u2019 page. It also tells that this rule has a support of 0.001288475 and that this particular rule was obeyed a total of 9 times in our data.<\/p>\n<p>Now that\u2019s somewhat of a mouthful, and may be difficult to understand at first. In order to understand what the above statement means we need to define the terms in this context<\/p>\n<p>Support: The ratio of times the two pages in Rule[1] appear in our search logs to all the pages viewed in our data i.e lhs+rhs\/total_pageviews<\/p>\n<p>Confidence: The ratio of number of pageviews for the page on lhs and number of views of the page on rhs to number of pageviews of the page on rhs i.e lhs+rhs\/rhs.<\/p>\n<p>Lift: The ratio of expected confidence to actual confidence, higher lift indicates stronger association.<\/p>\n<p>Still confused? All this text seems a little too much to understand, so it\u2019s better if we visualize this data to make more sense of it. This can be done quite simply using the \u2018arulesViz\u2019 library we imported. In order to visualize this data in the form of a graph, we use the following function:<\/p>\n<pre class=\"source-code\">plot(web_rules[1:5],'graph')\n<\/pre>\n<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/17_image3.png\" alt=\" plot web rules \" \/><\/p>\n<p>This graph essentially visualizes the set of rules we got before. And there you have it, Market Basket Analysis on Google Analytics using Snowplow. \u00a0Keep in mind that this is only a bare-bones implementation of MBA, feel free to explore more options and the diverse features offered by the the libraries we\u2019ve used in R.<\/p>\n<p>Feel free to comment if you have any queries.<\/p>\n","protected":false},"excerpt":{"rendered":"<p style=\"white-space: pre-wrap;\">Learn how to do Market Basket Analysis of Google Analytics data using Snowplow and R. Understand how it is different from Google Analytics, Mixpanel and what you can do to improve your business. <\/p>\n","protected":false},"author":5,"featured_media":452,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"content-type":"","footnotes":""},"categories":[3],"tags":[61,95,103],"acf":[],"aioseo_notices":[],"_links":{"self":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/450"}],"collection":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/users\/5"}],"replies":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/comments?post=450"}],"version-history":[{"count":0,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/450\/revisions"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/media\/452"}],"wp:attachment":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/media?parent=450"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/categories?post=450"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/tags?post=450"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}