{"id":533,"date":"2019-01-29T12:17:41","date_gmt":"2019-01-29T07:17:41","guid":{"rendered":"http:\/\/18.139.242.7\/2019\/01\/29\/serverless-data-analysis-using-bigquery\/"},"modified":"2023-05-26T10:30:58","modified_gmt":"2023-05-26T10:30:58","slug":"serverless-data-analysis-using-bigquery","status":"publish","type":"post","link":"https:\/\/marketlytics.com\/blog\/serverless-data-analysis-using-bigquery\/","title":{"rendered":"Serverless data analysis using BigQuery"},"content":{"rendered":"<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/serverless.png\" alt=\"\"><\/p>\n<h3 style=\"white-space: pre-wrap;\"><strong>Introduction:<\/strong><\/h3>\n<p style=\"white-space: pre-wrap;\">Data analysis at scale requires faster and larger systems for data warehousing and processing, which definitely incurs high costs and management overhead. Google BigQuery is a cloud-based big data analytics service offered by Google Cloud Platform for processing very large read-only data sets without any configurations overhead. BigQuery was designed for analyzing data in &nbsp;the order of billions of rows, using an SQL-like syntax. BigQuery enables you to set your data warehouse as quickly as possible with the latency of seconds. You do not need to set up, organize and manage your data warehouse. It is integrated with many other tools in the Google Cloud Platform as well which enables you to create robust data pipelines very quickly and efficiently.<\/p>\n<h3 style=\"white-space: pre-wrap;\"><strong>What it means to be serverless?<\/strong><\/h3>\n<p style=\"white-space: pre-wrap;\">While there is no official community definition of being serverless, we will begin explaining the concept by stating some of the leading principles of what it means to be serverless.<\/p>\n<h3 style=\"white-space: pre-wrap;\"><strong>Principles of serverless-ness:<\/strong><\/h3>\n<ul data-rte-list=\"default\">\n<li>\n<p style=\"white-space: pre-wrap;\"><strong>Invisible infrastructure <\/strong>:<\/p>\n<\/li>\n<\/ul>\n<p style=\"white-space: pre-wrap;\">You can run your web server, &nbsp;some heavy-number-crunching code, or a large query and all the administrative overhead like the OS updates, networking, etc is abstracted away from you.<\/p>\n<ul data-rte-list=\"default\">\n<li>\n<p style=\"white-space: pre-wrap;\"><strong>Automatic scaling<\/strong><\/p>\n<\/li>\n<\/ul>\n<p style=\"white-space: pre-wrap;\">Serverless computing increases\/decreases the compute capacity as needed, making sure &nbsp;that the resources are scaled efficiently in case of heavy workloads while still keeping check that they are not under-utilized in case of low workloads. They scale up and down very tightly with your actual usage.<\/p>\n<ul data-rte-list=\"default\">\n<li>\n<p style=\"white-space: pre-wrap;\"><strong>Pay per use<\/strong><\/p>\n<\/li>\n<\/ul>\n<p style=\"white-space: pre-wrap;\">Serverless computing only charges you for the time you are actually doing the processing.<\/p>\n<h3 style=\"white-space: pre-wrap;\"><strong>Underlying Architecture of BigQuery<\/strong><\/h3>\n<p style=\"white-space: pre-wrap;\">Storing and querying massive petabyte scale datasets can be a time consuming and expensive task without the right hardware and infrastructure. Many of you might have experienced the pain of querying heavy datasets on your local machines. BigQuery enables you to perform near real time analysis of petabyte scale datasets with the latency of milliseconds. BigQuery fits best in OLAP (analytical) workloads. It is not used for OLTP (transactional) workloads. BigQuery can be accessed via WebUI, command line tool or by making a call to BigQuery REST API using different client libraries.<\/p>\n<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/7_image1.png\" alt=\"\"><\/p>\n<p style=\"white-space: pre-wrap;\">BigQuery requests are powered by the Dremel query engine (<a href=\"https:\/\/static.googleusercontent.com\/media\/research.google.com\/en\/\/pubs\/archive\/36632.pdf\"><span style=\"text-decoration: underline;\">paper on Dremel published in 2010<\/span><\/a>), which orchestrates your query by breaking it down &nbsp;into pieces and reassembling the results. BigQuery relies on Colossus, Google\u2019s latest generation distributed file system. Google Jupiter network allows us to efficiently and quickly distribute large workloads.<\/p>\n<p style=\"white-space: pre-wrap;\">Under the hood, BigQuery uses the columnar storage format. Every column is stored in a separate file and that file is encrypted and replicated. This makes read performance really fast. BigQuery is by design <strong>append-only<\/strong> preferred. That means that you better let duplicate rows from the same entity in the table and write your queries to always read the most recent row. You have only 100 updates per table per day. BigQuery has tight integrations with other Google cloud services like Dataproc (connector), Dataflow, Cloud Storage, Cloud Datalab, Cloud Dataprep etc.<\/p>\n<h3 style=\"white-space: pre-wrap;\"><strong>Separation of Compute and Storage:<\/strong><\/h3>\n<p style=\"white-space: pre-wrap;\">Separation of compute and state is the secret that makes BigQuery so good at concurrency. The separation of compute and state refers to the ability to maintain intermediate state between processing stages in a high-performance component separate from either the compute cluster or storage. There are several benefits to separating compute from state,<\/p>\n<ul data-rte-list=\"default\">\n<li>\n<p style=\"white-space: pre-wrap;\">Less state in compute means compute becomes more ephemeral and scalable.<\/p>\n<\/li>\n<li>\n<p style=\"white-space: pre-wrap;\">Keeping less state in processing nodes makes workloads more resilient to individual node issues.<\/p>\n<\/li>\n<li>\n<p style=\"white-space: pre-wrap;\">Processing is more streamlined; processing stages don\u2019t conflict within the same compute nodes resulting in resource contention and bottlenecks.<\/p>\n<\/li>\n<\/ul>\n<p style=\"white-space: pre-wrap;\">To demonstrate this concept, let\u2019s take a look at a BigQuery query presented by Jordan Tigani in his <a href=\"https:\/\/www.youtube.com\/watch?v=UueWySREWvk\"><span style=\"text-decoration: underline;\">Google Cloud Next \u201817 session<\/span><\/a>:<\/p>\n<p style=\"white-space: pre-wrap;\">bigquery-samples.wikipedia_benchmark.Wiki100B is the <a href=\"https:\/\/bigquery.cloud.google.com\/dataset\/bigquery-samples:wikipedia_benchmark?pli=1\"><span style=\"text-decoration: underline;\">public dataset<\/span><\/a>. BigQuery Supports both standard SQL 2011 and Legacy SQL.<\/p>\n<p style=\"white-space: pre-wrap;\">`bigquery-samples.wikipedia_benchmark.Wiki100B` for Standard SQL<\/p>\n<p style=\"white-space: pre-wrap;\">[bigquery-samples:wikipedia_benchmark.Wiki100B] for Legacy SQL<\/p>\n<p><script src=\"https:\/\/gist.github.com\/marisattar\/6b27856ffb9e55cae3b9087198f12d91.js\"><\/script><\/p>\n<p style=\"white-space: pre-wrap;\">This query reveals a shuffle after both Stage 1 and Stage 2. However, rather than moving data from Stage 1 nodes to Stage 2 nodes, the query uses a separate, in-memory subservice to keep the shuffled data. This is a much cleaner architecture \u2014 BigQuery avoids the resource sloshing and bottlenecking associated with classical shuffle. It can also quickly recover from unexpected out-of-memory conditions associated with data skew in shuffle.<\/p>\n<p style=\"white-space: pre-wrap;\">You can view the execution plan and timeline area chart of the query by hitting the &nbsp;<strong>Next <\/strong>button. This helps us to analyze and optimize our query at different stages, if needed.<\/p>\n<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/7_image3.png\" alt=\"\"><\/p>\n<h3 style=\"white-space: pre-wrap;\"><strong>BigQuery Data Formats:<\/strong><\/h3>\n<ul data-rte-list=\"default\">\n<li>\n<p style=\"white-space: pre-wrap;\"><strong>Load:<\/strong><\/p>\n<\/li>\n<\/ul>\n<p style=\"white-space: pre-wrap;\">CSV, JSON (Newline Delimited), Avro (Best for compressed files), Parquet, Datastore Backups (Google object storage database)<\/p>\n<ul data-rte-list=\"default\">\n<li>\n<p style=\"white-space: pre-wrap;\"><strong>Read:<\/strong><\/p>\n<\/li>\n<\/ul>\n<p style=\"white-space: pre-wrap;\">CSV, JSON, Avro, Parquet<\/p>\n<ul data-rte-list=\"default\">\n<li>\n<p style=\"white-space: pre-wrap;\"><strong>Export:<\/strong><\/p>\n<\/li>\n<\/ul>\n<p style=\"white-space: pre-wrap;\">CSV, JSON, Avro, Google Cloud Storage (gs:\/\/Bucket_name)<\/p>\n<h3 style=\"white-space: pre-wrap;\"><strong>BigQuery Project Hierarchy and Roles:<\/strong><\/h3>\n<p style=\"white-space: pre-wrap;\">A BigQuery Project can have multiple owners, and contains users and datasets. A dataset further contains multiple tables and views. Think of views as more restricted tables containing select columns of the original table to provide a more controlled access to different stakeholders. Access control can only be provided at project, dataset and view levels.<\/p>\n<p style=\"white-space: pre-wrap;\"><strong>BigQuery Pricing:<\/strong><\/p>\n<p style=\"white-space: pre-wrap;\">BigQuery storage costs are based solely on the amount of data you store. Storage charges can be:<\/p>\n<ul data-rte-list=\"default\">\n<li>\n<p style=\"white-space: pre-wrap;\"><a href=\"https:\/\/cloud.google.com\/bigquery\/pricing#active_storage\"><span style=\"text-decoration: underline;\">Active<\/span><\/a> \u2014 A monthly charge for data stored in tables you have modified in the last 90 days.<\/p>\n<\/li>\n<\/ul>\n<ul data-rte-list=\"default\">\n<li>\n<p style=\"white-space: pre-wrap;\"><a href=\"https:\/\/cloud.google.com\/bigquery\/pricing#long-term-storage\"><span style=\"text-decoration: underline;\">Long-term<\/span><\/a> \u2014 A lower monthly charge for data stored in tables that have not been modified in the last 90 days.<\/p>\n<\/li>\n<\/ul>\n<p style=\"white-space: pre-wrap;\">Query costs are based on the amount of data processed by the query. Query charges can be:<\/p>\n<ul data-rte-list=\"default\">\n<li>\n<p style=\"white-space: pre-wrap;\"><a href=\"https:\/\/cloud.google.com\/bigquery\/pricing#on_demand_pricing\"><span style=\"text-decoration: underline;\">On-demand<\/span><\/a> \u2014 The most flexible option. On-demand query pricing is based solely on usage.<\/p>\n<\/li>\n<li>\n<p style=\"white-space: pre-wrap;\"><a href=\"https:\/\/cloud.google.com\/bigquery\/pricing#flat_rate_pricing\"><span style=\"text-decoration: underline;\">Flat-rate<\/span><\/a> \u2014 Enterprise customers generally prefer flat-rate pricing for queries because it offers predictable, fixed month-to-month costs.<\/p>\n<\/li>\n<\/ul>\n<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/6_image2.png\" alt=\"\"><\/p>\n<p style=\"white-space: pre-wrap;\">Google cloud platform also offers the <a href=\"https:\/\/cloud.google.com\/products\/calculator\/\"><span style=\"text-decoration: underline;\">pricing calculator <\/span><\/a>by which you can estimate the cost as per your use case.<\/p>\n<h3 style=\"white-space: pre-wrap;\"><strong>Conclusion:<\/strong><\/h3>\n<p style=\"white-space: pre-wrap;\">BigQuery is a fully optimized, no-ops solution for many use cases. It has the capacity to &nbsp;handle streaming inserts as well as some other interesting features like nested fields, structs, and partitioning tables (based on ingestion time and timestamp)<\/p>\n<p style=\"white-space: pre-wrap;\">Here at Markelytics, we recently tried out BigQuery for firebase data (for a survey app) and email data for Marketo (for an auction company).<\/p>\n<p style=\"white-space: pre-wrap;\">Firebase stores user data, event data and campaign data in nested records in partition tables. The <strong>UNNEST<\/strong> function of standard SQL proved to be very useful in getting the data ready for visualization in data studio by flattening and reshaping it which further helped build user funnels, visualize event performance and filter out performance based on specific user activity.<\/p>\n<p style=\"white-space: pre-wrap;\">Marketo is a marketing automation platform which stores email related data (email opens, email sends, email clicks etc). The purpose was to perform RFM (Recency, Frequency and Monetary value) analysis. BigQuery acted as a sink for Stitch, which is a connector for Marketo and used to pull data out of the marketo platform. The serverless nature of BigQuery allowed me to process 10s of millions of rows and &nbsp;aggregate data in order of seconds.<\/p>\n<p style=\"white-space: pre-wrap;\">As Google analytics partners we are used to getting most of our answers in warp speed without worrying about the infrastructure that powers it and we are excited to see how we can scale this approach to do this on more of client data and provide answers to broader business questions.<\/p>\n<p style=\"white-space: pre-wrap;\">This is a new series of articles that takes a look at the upcoming convergence of the digital analytics world with statistical learning. Read what Umair, our statistical learning lead has to say, right<a href=\"https:\/\/marketlytics.com\/blog\/data-science-y-guy-entering-digital-analytics\"><span style=\"text-decoration: underline;\"> here.<\/span><\/a><\/p>\n<p style=\"white-space: pre-wrap;\">\n<p style=\"white-space: pre-wrap;\">\n","protected":false},"excerpt":{"rendered":"<p style=\"white-space:pre-wrap;\">This blog highlights the need to go server-less from on-premise systems and how Google Big Query helps you to achieve that in much more efficient and completely No-ops way.<\/p>\n<p style=\"white-space:pre-wrap;\">  <\/p>\n","protected":false},"author":5,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"content-type":"","footnotes":""},"categories":[3,156],"tags":[],"acf":[],"aioseo_notices":[],"_links":{"self":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/533"}],"collection":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/users\/5"}],"replies":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/comments?post=533"}],"version-history":[{"count":0,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/533\/revisions"}],"wp:attachment":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/media?parent=533"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/categories?post=533"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/tags?post=533"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}