{"id":155,"date":"2014-11-21T19:53:56","date_gmt":"2014-11-21T14:53:56","guid":{"rendered":"http:\/\/18.139.242.7\/2014\/11\/21\/tracking-banner-impressions-using-google-tag-manager-and-universal-analytics\/"},"modified":"2022-10-25T16:00:19","modified_gmt":"2022-10-25T16:00:19","slug":"tracking-banner-impressions-using-google-tag-manager-and-universal-analytics","status":"publish","type":"post","link":"https:\/\/marketlytics.com\/blog\/tracking-banner-impressions-using-google-tag-manager-and-universal-analytics\/","title":{"rendered":"How to Track Banner Impressions Using Google Tag Manager and Universal Analytics"},"content":{"rendered":"\n<p>Say you want to track banner impressions or views of a piece of sponsored \/ featured content on your awesome blog. It doesn&#8217;t matter what the piece of content is as long as its distinctly identifiable by an id or class. We want to measure impression as an event in <a href=\"https:\/\/marketlytics.com\/analytics-faq\/differenc-between-google-analytics-and-universal-analytics\/\" target=\"_blank\" rel=\"noopener\">universal analytics<\/a> as soon as the page loads.<\/p>\n\n\n\n<p>Doing this with Google Tag Manager is pretty straightforward here is what we need. Assuming this is the sponsored content we have:<\/p>\n\n\n\n<pre class=\"wp-block-preformatted\"><span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">div<\/span> <span class=\"cm-attribute\">id<\/span>=<span class=\"cm-string\">\"sponsored-content\"<\/span> <span class=\"cm-attribute\">data-sp-content<\/span>=<span class=\"cm-string\">\"paypal\"<\/span> <span class=\"cm-attribute\">data-sp-location<\/span>=<span class=\"cm-string\">\"sidebar\"<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span>\n    <span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">h1<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span>Never Miss a Transaction!<span class=\"cm-tag cm-bracket\">&lt;\/<\/span><span class=\"cm-tag\">h1<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span>\n    <span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">p<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span> 100% accuracy of paypal transactions in google analytics\n    <span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">a<\/span> <span class=\"cm-attribute\">href<\/span>=<span class=\"cm-string\">\"https:\/\/marketlytics.com\/always-measuring\/\"<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span>Beta Signups Open<span class=\"cm-tag cm-bracket\">&lt;\/<\/span><span class=\"cm-tag\">a<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span>\n    <span class=\"cm-tag cm-bracket\">&lt;\/<\/span><span class=\"cm-tag\">p<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span>\n<span class=\"cm-tag cm-bracket\">&lt;\/<\/span><span class=\"cm-tag\">div<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span><\/pre>\n\n\n\n<p>I want to see whenever this code block is displayed on a page. The easiest way to do so is look for the block whenever a page is loaded. We can do this by including this code with the google analytics pageview tracking code already being triggered.<\/p>\n\n\n\n<p><em>ps. The paypal tracking thing is completely real and awesome if your sites uses paypal <a href=\"https:\/\/goo.gl\/forms\/sRhZ5EQE30\" target=\"_blank\" rel=\"noopener noreferrer\">check it out here<\/a>.<\/em><\/p>\n\n\n\n<p><strong>Detecting Banner:<\/strong> To do this create a new js custom JavaScript variable. Name it &#8220;detect sponsored content&#8221; Include the following code:<\/p>\n\n\n\n<pre class=\"wp-block-preformatted\"><span class=\"cm-keyword\">function<\/span>(){\n  <span class=\"cm-keyword\">return<\/span> <span class=\"cm-keyword\">function<\/span>(){\n    <span class=\"cm-comment\">\/\/ Check if the page contains the div<\/span>\n    <span class=\"cm-keyword\">var<\/span> <span class=\"cm-def\">node<\/span> <span class=\"cm-operator\">=<\/span> <span class=\"cm-variable\">document<\/span>.<span class=\"cm-property\">getElementById<\/span>(<span class=\"cm-string\">\"sponsored-content\"<\/span>); <span class=\"cm-comment\">\/\/ use whatever id your block has<\/span>\n    <span class=\"cm-variable\">isInBody<\/span> <span class=\"cm-operator\">=<\/span> <span class=\"cm-variable\">document<\/span>.<span class=\"cm-property\">body<\/span>.<span class=\"cm-property\">contains<\/span>(<span class=\"cm-variable-2\">node<\/span>);\n \n    <span class=\"cm-comment\">\/\/ If true<\/span>\n    <span class=\"cm-keyword\">if<\/span> (<span class=\"cm-variable\">isInBody<\/span>){\n        <span class=\"cm-variable\">dataLayer<\/span>.<span class=\"cm-property\">push<\/span>({<span class=\"cm-string cm-property\">'event'<\/span>:<span class=\"cm-string\">'spContent-detected'<\/span>});\n    }\n  }\n}<\/pre>\n\n\n\n<p>Now add this to your Universal Analytics Pageview tag. Field to Set hitCallback set value to {{detect sponsored content}}.<\/p>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/hitcallback-detent-banner.png\" alt=\" set hitcallback in pageview tag \"\/><\/figure>\n\n\n\n<p>Now whenever the pageview tag loads and detects the sponsored content it will fire an event. What we want to do is use the GTM event to trigger an event in GA.<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><a href=\"https:\/\/marketlytics.com\/contact-us\/\" target=\"_blank\" rel=\"noreferrer noopener\"><img decoding=\"async\" width=\"1024\" height=\"384\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2022\/10\/Google-Analytics-Expert-1024x384.png\" alt=\"\" class=\"wp-image-10789\" srcset=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2022\/10\/Google-Analytics-Expert-1024x384.png 1024w, https:\/\/marketlytics.com\/wp-content\/uploads\/2022\/10\/Google-Analytics-Expert-300x113.png 300w, https:\/\/marketlytics.com\/wp-content\/uploads\/2022\/10\/Google-Analytics-Expert-768x288.png 768w, https:\/\/marketlytics.com\/wp-content\/uploads\/2022\/10\/Google-Analytics-Expert-1536x576.png 1536w, https:\/\/marketlytics.com\/wp-content\/uploads\/2022\/10\/Google-Analytics-Expert-2048x768.png 2048w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/a><\/figure>\n\n\n\n<p>We will extract the details about the content name \/ location etc and pass it to google analytics. Here is where our weird sounding <strong>data-sp-content<\/strong> and <strong>data-sp-location<\/strong> come in handy. We need two more custom js variables to do this.<\/p>\n\n\n\n<p><strong>Variable 1:<\/strong> Name the variable &#8220;detect sponsored name&#8221;<\/p>\n\n\n\n<pre class=\"wp-block-preformatted\"><span class=\"cm-keyword\">function<\/span>(){\n    <span class=\"cm-keyword\">var<\/span> <span class=\"cm-def\">contentId<\/span> <span class=\"cm-operator\">=<\/span> <span class=\"cm-variable\">document<\/span>.<span class=\"cm-property\">getElementById<\/span>(<span class=\"cm-string\">\"sponsored-content\"<\/span>); <span class=\"cm-comment\">\/\/ id of our sponsored block<\/span>\n    <span class=\"cm-keyword\">var<\/span> <span class=\"cm-def\">contentName<\/span> <span class=\"cm-operator\">=<\/span> <span class=\"cm-variable-2\">contentId<\/span>.<span class=\"cm-property\">getAttribute<\/span>(<span class=\"cm-string\">\"data-sp-content\"<\/span>); <span class=\"cm-comment\">\/\/custom attribute name<\/span>\n \n    <span class=\"cm-keyword\">return<\/span> <span class=\"cm-variable-2\">contentName<\/span>;\n}<\/pre>\n\n\n\n<p><strong>Variable 2:<\/strong> Name the variable &#8220;detect sponsored location&#8221;<\/p>\n\n\n\n<pre class=\"wp-block-preformatted\"><span class=\"cm-keyword\">function<\/span>(){\n    <span class=\"cm-keyword\">var<\/span> <span class=\"cm-def\">contentId<\/span> <span class=\"cm-operator\">=<\/span> <span class=\"cm-variable\">document<\/span>.<span class=\"cm-property\">getElementById<\/span>(<span class=\"cm-string\">\"sponsored-content\"<\/span>); <span class=\"cm-comment\">\/\/ id of our sponsored block<\/span>\n    <span class=\"cm-keyword\">var<\/span> <span class=\"cm-def\">contentLocation<\/span> <span class=\"cm-operator\">=<\/span> <span class=\"cm-variable-2\">contentId<\/span>.<span class=\"cm-property\">getAttribute<\/span>(<span class=\"cm-string\">\"data-sp-location\"<\/span>); <span class=\"cm-comment\">\/\/custom attribute name<\/span>\n \n    <span class=\"cm-keyword\">return<\/span> <span class=\"cm-variable-2\">contentLocation<\/span>;\n}<\/pre>\n\n\n\n<p>Setup another Tag in GTM Universal Analytics &#8211; Event &#8211; Sponsored Content Now we want to dynamically populate data about which piece of content it was into the event.<\/p>\n\n\n\n<p><strong>Event Category:<\/strong> Sponsored Impression <em>Event Action<\/em>: {{detect sponsored name}} <em>Event Label<\/em>: {{detect sponsored location}}<\/p>\n\n\n\n<p><strong>Opt Interaction:<\/strong> True (we dont want this affecting bounce rate).<\/p>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/send-impression-data.png\" alt=\" banner impression event tag \"\/><\/figure>\n\n\n\n<p>Set the trigger for tag to <em>{{event}}<\/em> equals spContent-detected<\/p>\n\n\n\n<p>Now using this we can fire events whenever we want to track impressions of a piece of content. Remember the piece of content can be anything your hello bar, side bar white paper, some plug within your content (like my paypal example) or various offers in a long sales page.<\/p>\n\n\n\n<h3 class=\"wp-block-heading\">Some stray observations<\/h3>\n\n\n\n<p>We can use the same method to trigger an enhanced ecommerce <a href=\"https:\/\/developers.google.com\/analytics\/devguides\/collection\/analyticsjs\/enhanced-ecommerce#measuring-promos\" target=\"_blank\" rel=\"noopener noreferrer\">promotion impression<\/a> as well.<\/p>\n\n\n\n<p>Another alternate way maybe to fire a custom metric + custom dimension combo at the page level.<\/p>\n\n\n\n<p>Lastly, a good way to make banner impressions tracking a bit more accurate could be to fire them when they actually come in view. There is a <a href=\"https:\/\/github.com\/protonet\/jquery.inview\" target=\"_blank\" rel=\"noopener noreferrer\">cool jquery library<\/a> that can help with that.<\/p>\n\n\n\n<p>Let me know how you end up using this.<\/p>\n\n\n\n<p>You can even check our work on it to get more insights by clicking <a href=\"https:\/\/marketlytics.com\/ecommerce\/\">here.<\/a><\/p>\n\n\n\n<p>ps. This post is inspired by a question on <a href=\"https:\/\/plus.google.com\/107209440154641560334\/posts\/cyaWMNt52QS\" target=\"_blank\" rel=\"noopener noreferrer\">G+ Google Analytics community<\/a><\/p>\n\n\n\n<div class=\"poptin-embedded\" data-id=\"524d62d316aa4\">&nbsp;<\/div>\n","protected":false},"excerpt":{"rendered":"<p>Here is a cool way I use to track banner impressions and clicks on your site using google tag manager and bit of elbow grease.&nbsp;<\/p>\n","protected":false},"author":5,"featured_media":156,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"content-type":"","footnotes":""},"categories":[3],"tags":[21,66,85,108],"acf":[],"aioseo_notices":[],"_links":{"self":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/155"}],"collection":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/users\/5"}],"replies":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/comments?post=155"}],"version-history":[{"count":0,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/155\/revisions"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/media\/156"}],"wp:attachment":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/media?parent=155"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/categories?post=155"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/tags?post=155"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}