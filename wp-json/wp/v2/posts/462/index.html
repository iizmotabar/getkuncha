{"id":462,"date":"2018-05-22T10:31:47","date_gmt":"2018-05-22T05:31:47","guid":{"rendered":"http:\/\/18.139.242.7\/2018\/05\/22\/infusionsoft-real-time-data-to-analytics-tool\/"},"modified":"2018-05-22T10:31:47","modified_gmt":"2018-05-22T05:31:47","slug":"infusionsoft-real-time-data-to-analytics-tool","status":"publish","type":"post","link":"https:\/\/marketlytics.com\/blog\/infusionsoft-real-time-data-to-analytics-tool\/","title":{"rendered":"How to Send Infusionsoft&#8217;s Real-Time Data to Your Analytics Tools Using Webhooks"},"content":{"rendered":"<p>Infusionsoft is an email marketing and sales platform catering to small businesses. It helps manage and optimize customer relationships, marketing automation, lead generation and e-commerce. Infusionsoft comes with a ton of customizable dashboards and an option to integrate addons such as Graphly for advanced visualization.<\/p>\n<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/4_image8.png\" alt=\" infusionsoft graphs \" \/><\/p>\n<h3><strong>The Sad Part<\/strong><\/h3>\n<p>Even though Infusionsoft is a powerful tool, it has, like most others, a few limitations here and there. One of the major ones being, that you can\u2019t store all the data from the website (events, pageviews etc) and other user activities, in a consolidated manner, on to one tool.<\/p>\n<p>We know how annoying this situation can quickly become because we have been there, done that, AND, we found a way to make it work! Our client wanted us to combine all user activities (from website and Infusionsoft) and present them in the form of an interactive dashboard to help them get useful insights and make better business decisions. Since consolidation wasn\u2019t a built-in option, we needed to figure out a way around it.<\/p>\n<p><strong>All is not lost &#8211; Here&#8217;s how to make it work<\/strong><\/p>\n<p>Fortunately, Infusionsoft allow us to pull data to any other platform using their APIs. However, the issue with the REST API is, that they are stateless. In other words, it won\u2019t give us real-time results and we\u2019d have to make an API call to get it. Every. Single. Time.<\/p>\n<p>Yes. Bummer!<\/p>\n<p>Hold on though, we got your back on that too.<\/p>\n<p>Enter webhook and that may very well be the end of your troubles with Infusionsoft.<\/p>\n<p>Webhook is an advanced version of REST API. Using which we can fetch the Infusionsoft data in real time.<\/p>\n<p>Here\u2019s how.<\/p>\n<p><strong>Note: <\/strong>we are going to use Node.js to fetch the data and store it in Amplitude for analysis. But this guide can be used for implementation on any required language and analytics tool. We will also use <a href=\"https:\/\/ngrok.com\/\" target=\"_blank\" rel=\"noopener noreferrer\">ngrok<\/a> to send the traffic from Infusionsoft to over local server during development.<\/p>\n<p>Following is the route on which we will receive the response from Infusionsoft.<\/p>\n<pre class=\"source-code\">app.post('\/infusion', (req, res) =&gt; {\n    if(req.headers['x-hook-secret']){\n        res.setHeader(\"x-hook-secret\", req.headers['x-hook-secret']);\n    }\n    else{\n        \/\/... our magic code here..\n       }\n    res.sendStatus(200);\n});<\/pre>\n<p>When we create a hook in webhooks it sends &#8216;<strong>x-hook-secret<\/strong>&#8216; in the header which needs to be sent back to the webhook in order to verify the route.<\/p>\n<p>The \u2018If-statement\u2019 in code above does just that. It first checks if the request header has <strong>&#8216;x-hook-secret<\/strong>&#8216;. If it does, the same secret code is resent with the response header.<\/p>\n<p>Now then, let\u2019s set up the webhook in Infusionsoft.<\/p>\n<p>Go to \u00a0the developer <a href=\"https:\/\/developer.infusionsoft.com\/docs\/rest\/#!\/Account_Info\/getAccountProfileUsingGET\" target=\"_blank\" rel=\"noopener noreferrer\">page<\/a> and hit \u00a0\u201cTRY THE API\u201d, \u00a0on the top right corner of the page to get the access token.<\/p>\n<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/17_image1.png\" alt=\" try the API \" \/><\/p>\n<p>A window will popup asking ask you to enter the Client ID and Secret Key, which you will get when you create a developers account in Infusionsoft. Once you enter the credentials, you will be given an Access Token to try out the API.<\/p>\n<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/7_image6.png\" alt=\" generate access token \" \/><\/p>\n<p>When you have your Access Token, you can move on to create your webhook.<\/p>\n<p>Go to <strong>REST HOOKs &gt; Create a Hook Subscription<\/strong> in the left navigation panel and enter following<\/p>\n<pre class=\"source-code\">{\n  \"eventKey\": \"contact.add\",\n  \"hookUrl\": \"https:\/\/9e3d2876.ngrok.io\/infusion\"\n}<\/pre>\n<p>&#8220;<strong>https:\/\/9e3d2876.ngrok.io<\/strong>&#8221; is the random generated ngrok URL and &#8220;<strong>contact.add<\/strong>&#8221; is the event on which we want Infusionsoft to send response to our route. You can go to list hook event type in left panel to get the list of available events.<\/p>\n<p>If the route properly sends the &#8216;<strong>x-hook-secret<\/strong>&#8216; in response header you will get the status \u2018Verified\u2019.<\/p>\n<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/7_image4.png\" alt=\" status message \" \/><\/p>\n<p>Now, whenever a contact is added in Infusionsoft you will get the response with a contact id on your server. You can manually test this by adding a contact in your Infusionsoft account.<\/p>\n<p>This, however, is only half done. So far, we got the contact ID of the contact added. Now, using this ID, we will fetch the remaining details using the plain old API call.<\/p>\n<p>Infusionsoft has a library to make an API call in node.js named <a href=\"https:\/\/github.com\/bvalosek\/infusionsoft-api\" target=\"_blank\" rel=\"noopener noreferrer\">Infusionsoft API<\/a>.<\/p>\n<p>Open terminal\/cmd on your application directory and type the following code to integrate Infusionsoft library.<\/p>\n<pre class=\"source-code\">npm install infusionsoft-api --save<\/pre>\n<p>Now, remember the route code with the if-statement?<\/p>\n<p>No?<\/p>\n<p>Scroll up and check out the part where we confirm our route.<\/p>\n<p>Notice how the \u2018else\u2019 part is empty?<\/p>\n<p>Yep. Now is when we code it.<\/p>\n<pre class=\"source-code\">var api = require('infusionsoft-api');\nvar infusionsoft = new api.DataContext('myapp', 'MY_API_KEY');<\/pre>\n<p>You can get the &#8216;<strong>myapp<\/strong>&#8216; directly from the URL when you login to your dashboard in Infusionsoft.<\/p>\n<p>For Example: <a href=\"https:\/\/myapp.infusionsoft.com\/Dashboard\/userDashboard.jsp\" target=\"_blank\" rel=\"noopener noreferrer\">https:\/\/myapp.infusionsoft.com\/Dashboard\/userDashboard.jsp<\/a><\/p>\n<p>For <strong>MY_API_KEY<\/strong>&#8216; go settings in admin section then to the application tab in the left panel and scroll down. You will be asked to enter <strong>API passphrase<\/strong> after which you can get your <strong>MY_API_KEY<\/strong>&#8216;.<\/p>\n<pre class=\"source-code\">infusionsoft.Contacts\n    .where(Contact.Id, reqBody.object_keys[0].id)\n    .toArray()\n    .done(function(result) {\n        amplitudeEventLong(results[0],\"added contact\");\n    });<\/pre>\n<p>The aforestated codegets the contact details of the person whose contact is what we got in the response of the webhook we set earlier ( reqBody.object_keys[0].id gives the contact id from webhook response).<\/p>\n<p>The data \u00a0we got as a result of the api call is passed to a function with the \u00a0event name set as \u201cadded contact\u201d. This is where we will send the data to Amplitude.<\/p>\n<pre class=\"source-code\">const amplitudeEventLong = (properties,eventName) =&gt;{   \n    let eventArray = [{\n        user_id:properties.Email,\n            device_id:properties.Id,\n        event_type:eventName,\n        event_properties:properties,\n        time:Math.round(new Date().getTime()\/1000)\n    }];     \n    request.post('https:\/\/api.amplitude.com\/httpsapi', {\n        form:{\n            api_key:api_key,\n            event: JSON.stringify(eventArray)\n        }\n    },(err, httpsResponse, body)=&gt;{\n        if(err) console.log(\"___error event___\",err);\n        console.log(\"_____body event____ \",body);\n    });\n}<\/pre>\n<p>This will send the event \u2018added contact\u2019 to amplitude and also identify the user with the email id we got from Infusionsoft.<\/p>\n<p><strong>Note:\u00a0<\/strong>we are also passing device_id with event to tag the user\u2019s activity to the device Id. What does this do?<\/p>\n<p><a href=\"https:\/\/www.heroku.com\/\" target=\"_blank\" rel=\"noopener noreferrer\">Our final step is to host the application on a server such as Heroku and let the data be collected in real time, in your analytics tool.<\/a><\/p>\n<p>Don\u2019t forget to create a webhook with the new URL you get after hosting your application on the live server.<\/p>\n<h3><strong>Results<\/strong><\/h3>\n<p>In our case, when we were through with the procedure detailed above, we were not only able to track our user\u2019s front-end activity but also the events (such as contact add, transaction, recurring purchases etc) that happen within Infusionsoft. Everything consolidated on a single platform, Amplitude, in this case.<\/p>\n<p>We can even see how the user navigated through the website on Amplitudes\u2019 user-timeline now!<\/p>\n<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/5_image5.png\" alt=\"  User timeline with added contact event from infusionsoft.   \" \/> User timeline with added contact event from infusionsoft.<\/p>\n<p>And since this is a proper event, we are not only able to see the trend in any given period of time, but can also create funnels to get useful insight.<\/p>\n<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/16_image2.png\" alt=\"  Add to contact event trend in last 30 days  \" \/> Add to contact event trend in last 30 days<\/p>\n<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/14_image3.png\" alt=\"  User Opt-in to contact add funnel.  \" \/> User Opt-in to contact add funnel.<\/p>\n<p>For this project, we also had to integrate <a href=\"https:\/\/www.maropost.com\/\">Maropost<\/a> and its campaign related events to amplitude. If you want to see how we integrated Maropost with amplitude as soon as it\u2019s published, sign up for our newsletter and we\u2019ll send the link directly to you, so you don\u2019t miss it.<\/p>\n<p>If you need help implementing tracking on your website, or want custom tracking set up to better understand your users, <a href=\"https:\/\/marketlytics.com\/contact\/lets-talk\">let us know<\/a>! We help our clients make the most of their businesses.<\/p>\n","protected":false},"excerpt":{"rendered":"<p style=\"white-space: pre-wrap;\">Learn how to send Infusionsoft\u2019s real time data to Amplitude using webhooks to analyze the user behavior through different funnels. <\/p>\n","protected":false},"author":5,"featured_media":464,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"content-type":"","footnotes":""},"categories":[3,7],"tags":[14,85],"acf":[],"aioseo_notices":[],"_links":{"self":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/462"}],"collection":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/users\/5"}],"replies":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/comments?post=462"}],"version-history":[{"count":0,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/462\/revisions"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/media\/464"}],"wp:attachment":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/media?parent=462"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/categories?post=462"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/tags?post=462"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}