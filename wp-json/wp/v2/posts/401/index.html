{"id":401,"date":"2017-12-19T13:02:05","date_gmt":"2017-12-19T08:02:05","guid":{"rendered":"http:\/\/18.139.242.7\/2017\/12\/19\/pull-ecommerce-data-from-datalayer-gtm\/"},"modified":"2022-10-25T16:03:57","modified_gmt":"2022-10-25T16:03:57","slug":"pull-ecommerce-data-from-datalayer-gtm","status":"publish","type":"post","link":"https:\/\/marketlytics.com\/blog\/pull-ecommerce-data-from-datalayer-gtm\/","title":{"rendered":"How to Pull Ecommerce Data From DataLayer in GTM"},"content":{"rendered":"\n<p>If you are a Google Tag manager rockstar, you definitely know that it requires a good understanding of HTML, DOM,&nbsp;and JavaScript. The next learning triangle in GTM are Tags, Triggers,&nbsp;and Variables.<\/p>\n\n\n\n<p>If you are good at Tags, Triggers and Variables, you can do wonders with GTM. But the core feature of Google Tag Manager is the DataLayer. It is where the data is available and variables are used to save data from datalayer.<\/p>\n\n\n\n<p>In this article, we will talk about pulling ecommerce data from the datalayer using datalayer variables. This article will save the day for anyone who has implemented <a href=\"https:\/\/marketlytics.com\/blog\/enhanced-ecommerce-tracking-woocommerce-gtm\">enhanced ecommerce in Woocommerce<\/a> or <a href=\"https:\/\/marketlytics.com\/blog\/facebook-conversion-tracking-google-tag-manager\">Facebook conversion tracking via GTM<\/a>.<\/p>\n\n\n\n<p>I will be focusing on capturing datalayer values to pass as event parameter values for Facebook conversion tracking.<\/p>\n\n\n\n<h2 class=\"wp-block-heading\"><strong>Push Ecommerce Values to DataLayer<\/strong><\/h2>\n\n\n\n<p>The first thing you will have to do is to push the required details to datalayer. For an ecommerce site, you will have to push data the way you want to see in your reporting tool. I am not going to explain how to push data into <a href=\"https:\/\/developers.google.com\/tag-manager\/devguide\" target=\"_blank\" rel=\"noopener noreferrer\">datalayer<\/a> because this includes interaction with the website code and you might have to take the risk of bugging your anti-social developer.<\/p>\n\n\n\n<p>So I will focus on the less risky part, which is pulling data from the datalayer. If you have a Woocommerce website and are using Google Tag Manager plugin for ecommerce tracking then it automatically pushes data to datalayer.<\/p>\n\n\n\n<p>Let\u2019s start with the actual process.<\/p>\n\n\n\n<h2 class=\"wp-block-heading\"><strong>Know the DataLayer Variable<\/strong><\/h2>\n\n\n\n<p>DataLayer is a virtual layer on your website where the most useful data is stored. This data includes the page path, page URL, click classes..etc. You can capture useful data from datalayer and send to tools like Google Analytics and Facebook Pixel.<\/p>\n\n\n\n<p>Let\u2019s understand how we can capture the datalayer values for ViewContent event pixel and pass them as parameter values. If you are new to Facebook Pixel, we have got you covered. Read <a href=\"https:\/\/marketlytics.com\/blog\/facebook-conversion-tracking-google-tag-manager\">here<\/a>.<\/p>\n\n\n\n<p>Below is the JavaScript code for the viewcontent event.<\/p>\n\n\n\n<pre class=\"wp-block-preformatted\"><span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">script<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span>\n<span class=\"cm-variable\">fbq<\/span>(<span class=\"cm-variable\">\u2018track\u2019<\/span>,<span class=\"cm-variable\">\u2019ViewContent\u2019<\/span>, \n{\n<span class=\"cm-property\">content_name<\/span>: {{<span class=\"cm-variable\">datalayer<\/span> <span class=\"cm-variable\">variable<\/span>}},\n<span class=\"cm-variable\">content_category<\/span>: {{<span class=\"cm-variable\">datalayer<\/span> <span class=\"cm-variable\">variable<\/span>}},\n<span class=\"cm-variable\">content<\/span> <span class=\"cm-variable\">_ids<\/span>: {{<span class=\"cm-variable\">datalayer<\/span> <span class=\"cm-variable\">variable<\/span>}},\n<span class=\"cm-variable\">content_type<\/span>: <span class=\"cm-variable\">\u2018Product\u2019<\/span>,\n<span class=\"cm-variable\">value<\/span>: {{<span class=\"cm-variable\">datalayer<\/span> <span class=\"cm-variable\">variable<\/span>}},\n<span class=\"cm-variable\">currency<\/span>: {{<span class=\"cm-variable\">datalayer<\/span> <span class=\"cm-variable\">variable<\/span>}},\n});\n<span class=\"cm-tag cm-bracket\">&lt;\/<\/span><span class=\"cm-tag\">script<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span>\n<\/pre>\n\n\n\n<p>If you look at the above code, the parameter values contain datalayer variable. We will have to create a separate datalayer variable for each parameter.<\/p>\n\n\n\n<p>To capture datalayer values, you will have to install <a href=\"https:\/\/chrome.google.com\/webstore\/detail\/analytics-pros-datalayer\/kmcbdogdandhihllalknlcjfpdjcleom\">datalayer inspector chrome extension<\/a>. Next, you should have a little knowledge about the <a href=\"https:\/\/developers.google.com\/web\/tools\/chrome-devtools\/console\/\">inspect element and console<\/a>.<\/p>\n\n\n\n<p>Here I am assuming that you have pushed the required data to datalayer.<\/p>\n\n\n\n<p>Open your website in a tab and view a product.<\/p>\n\n\n\n<p>Right click on the page and click inspect.<\/p>\n\n\n\n<p>Click on console section and look for datalayer.push &#8211; ecommerce data<\/p>\n\n\n<div class=\"wp-block-image\">\n<figure class=\"aligncenter\"><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/datalayer-push.png\" alt=\" inspect datalayer\u00a0 \"\/><\/figure><\/div>\n\n\n<p>Click on the arrow to view the details.<\/p>\n\n\n<div class=\"wp-block-image\">\n<figure class=\"aligncenter\"><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/product-details.png\" alt=\" product details \"\/><\/figure><\/div>\n\n\n<p>As you can see in the above image, the details we require. We have all the info available on the datalayer.<\/p>\n\n\n\n<h2 class=\"wp-block-heading\"><strong>Pull Ecommerce Data From DataLayer using DataLayer variable<\/strong><\/h2>\n\n\n\n<p>Go to Google Tag Manager and navigate to variables. Within variables create a new user-defined variable. Select the variable type as datalayer.<\/p>\n\n\n<div class=\"wp-block-image\">\n<figure class=\"aligncenter\"><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/datalayer-variable.png\" alt=\" datalayer variable \"\/><\/figure><\/div>\n\n\n<p>Enter the variable name as <strong>Product Name<\/strong>, and enter <strong>product.name <\/strong>in the name field.<\/p>\n\n\n<div class=\"wp-block-image\">\n<figure class=\"aligncenter\"><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/product-name-variable.png\" alt=\" product name variable \"\/><\/figure><\/div>\n\n\n<p>Similarly, create other variables <strong>Product ID<\/strong>, <strong>Product Price<\/strong>, and <strong>Ecommerce<\/strong><strong> Currency<\/strong>.<\/p>\n\n\n\n<p>There is no product category data available so we can skip this and hence its an optional parameter as well.<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><a href=\"https:\/\/marketlytics.com\/contact-us\/\" target=\"_blank\" rel=\"noreferrer noopener\"><img decoding=\"async\" width=\"1024\" height=\"384\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2022\/10\/Google-Tag-Manager-Expert-1024x384.png\" alt=\"\" class=\"wp-image-10782\" srcset=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2022\/10\/Google-Tag-Manager-Expert-1024x384.png 1024w, https:\/\/marketlytics.com\/wp-content\/uploads\/2022\/10\/Google-Tag-Manager-Expert-300x113.png 300w, https:\/\/marketlytics.com\/wp-content\/uploads\/2022\/10\/Google-Tag-Manager-Expert-768x288.png 768w, https:\/\/marketlytics.com\/wp-content\/uploads\/2022\/10\/Google-Tag-Manager-Expert-1536x576.png 1536w, https:\/\/marketlytics.com\/wp-content\/uploads\/2022\/10\/Google-Tag-Manager-Expert-2048x768.png 2048w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/a><\/figure>\n\n\n\n<p>Now, navigate to your ViewContent tag and change the parameter values like below.<\/p>\n\n\n<div class=\"wp-block-image\">\n<figure class=\"aligncenter\"><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/viewcontent.png\" alt=\" custom html viewcontent event tag \"\/><\/figure><\/div>\n\n\n<p>This same will be applied to the AddToCart event. Because both these events include a single product interaction so single product details goes to datalayer.<\/p>\n\n\n\n<p><strong>InitiateCheckout<\/strong> and <strong>Purchase<\/strong> events are critical because it contains multiple products.<\/p>\n\n\n\n<p>Suppose a customer has added five products to the cart and on the checkout page, he has five items. So the method we used for capturing product details for ViewContent will not be useful here.<\/p>\n\n\n\n<p>Add multiple products to the cart and then proceed to checkout. Open console and see how how data is displayed in datalayer.<\/p>\n\n\n<div class=\"wp-block-image\">\n<figure class=\"aligncenter\"><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/checkout.png\" alt=\" checkout datalayer values \"\/><\/figure><\/div>\n\n\n<p>Now if you can see we have two items in the cart. How can we capture items in an array?<\/p>\n\n\n\n<p>Here we will need to create the following variables: total products in the cart, checkout product id, product name, and total price.<\/p>\n\n\n\n<p>Let\u2019s see how we can create the variables by looking at the data displayed in the image above.<\/p>\n\n\n\n<p>Go to GTM and create a new datalayer variable for cart quantity.<\/p>\n\n\n<div class=\"wp-block-image\">\n<figure class=\"aligncenter\"><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/cart-quantity.png\" alt=\" cart quatity variable \"\/><\/figure><\/div>\n\n\n<p>Create another variable for cart total price.<\/p>\n\n\n<div class=\"wp-block-image\">\n<figure class=\"aligncenter\"><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/cart-total.png\" alt=\" cart total variable \"\/><\/figure><\/div>\n\n\n<p>The third variable you will create is the cart items. This will contain the items of the cart.<\/p>\n\n\n<div class=\"wp-block-image\">\n<figure class=\"aligncenter\"><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/checkout-items.png\" alt=\" checkout items variable \"\/><\/figure><\/div>\n\n\n<p>Navigate to tags section, and create a new tag for <strong>InitiateCheckout<\/strong>. You can simply copy and paste the below code.<\/p>\n\n\n\n<pre class=\"wp-block-preformatted\"><span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">script<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span>\n <span class=\"cm-variable\">jQuery<\/span>(<span class=\"cm-variable\">document<\/span>).<span class=\"cm-property\">ready<\/span>(<span class=\"cm-keyword\">function<\/span>()\n { \n  <span class=\"cm-keyword\">var<\/span> <span class=\"cm-def\">Checkoutlen<\/span> <span class=\"cm-operator\">=<\/span> {{<span class=\"cm-variable\">Cart<\/span> <span class=\"cm-variable\">Quantity<\/span>}};\n  <span class=\"cm-keyword\">var<\/span> <span class=\"cm-variable\">checkoutID<\/span> <span class=\"cm-operator\">=<\/span> [];\n  <span class=\"cm-keyword\">var<\/span> <span class=\"cm-variable\">productName<\/span> <span class=\"cm-operator\">=<\/span> [];\n  <span class=\"cm-keyword\">var<\/span> <span class=\"cm-variable\">i<\/span>;\n  \n  <span class=\"cm-keyword\">for<\/span>(<span class=\"cm-variable\">i<\/span> <span class=\"cm-operator\">=<\/span> <span class=\"cm-number\">0<\/span>; <span class=\"cm-variable\">i<\/span><span class=\"cm-operator\">&lt;<\/span> <span class=\"cm-variable\">Checkoutlen<\/span>; <span class=\"cm-variable\">i<\/span><span class=\"cm-operator\">++<\/span>)\n  {\n    <span class=\"cm-variable\">checkoutID<\/span>.<span class=\"cm-property\">push<\/span>({{<span class=\"cm-variable\">Checkout<\/span> <span class=\"cm-variable\">Items<\/span>}}[<span class=\"cm-variable\">i<\/span>].<span class=\"cm-variable\">sku<\/span>);\n    <span class=\"cm-variable\">productName<\/span>.<span class=\"cm-property\">push<\/span>({{<span class=\"cm-variable\">Checkout<\/span> <span class=\"cm-variable\">Items<\/span>}}[<span class=\"cm-variable\">i<\/span>].<span class=\"cm-variable\">name<\/span>);\n\n  }\n   <span class=\"cm-operator\">&lt;!--<\/span> <span class=\"cm-variable\">Facebook<\/span> <span class=\"cm-variable\">Pixel<\/span> <span class=\"cm-variable\">Code<\/span> <span class=\"cm-operator\">--&gt;<\/span>\n\n    <span class=\"cm-variable\">fbq<\/span>(<span class=\"cm-string\">'track'<\/span>, <span class=\"cm-string\">'InitiateCheckout'<\/span>, {\n      <span class=\"cm-property\">content_ids<\/span>: <span class=\"cm-variable\">checkoutID<\/span>,\n      <span class=\"cm-property\">content_name<\/span>: <span class=\"cm-variable\">productName<\/span>,\n      <span class=\"cm-property\">content_type<\/span>: <span class=\"cm-string\">'product'<\/span>,\n      <span class=\"cm-property\">value<\/span>: {{<span class=\"cm-variable\">Cart<\/span> <span class=\"cm-variable\">Total<\/span>}},\n      <span class=\"cm-variable\">currency<\/span>: <span class=\"cm-string\">'USD'<\/span>\n    });\n\n    <span class=\"cm-operator\">&lt;!--<\/span> <span class=\"cm-variable\">END<\/span> <span class=\"cm-variable\">Facebook<\/span> <span class=\"cm-variable\">Pixel<\/span> <span class=\"cm-variable\">Code<\/span> <span class=\"cm-operator\">--&gt;<\/span>\n     });  \n<span class=\"cm-tag cm-bracket\">&lt;\/<\/span><span class=\"cm-tag\">script<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span>\n<\/pre>\n\n\n\n<p>Now, this captures any number of items in your cart. This will make it easy to send dynamic parameter values for each product.<\/p>\n\n\n\n<p>Similarly, you will have to do for the purchase event. The difference is you will be picking the purchase values from the thank page after a product is purchased.<\/p>\n\n\n\n<p>The datalayer variables you will be creating for this event will be <strong>order<\/strong><strong> length,<\/strong> and <strong>order total<\/strong>. You will set the parameter values using the method displayed for initiate checkout.<\/p>\n\n\n\n<h2 class=\"wp-block-heading\"><strong>How will the data be displayed?<\/strong><\/h2>\n\n\n\n<p>Once you pass the datalayer values, you can then test with Facebook pixel helper to verify if the data is appearing correctly.<\/p>\n\n\n<div class=\"wp-block-image\">\n<figure class=\"aligncenter\"><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/initcheckout.png\" alt=\" facebook pixel helper testing \"\/><\/figure><\/div>\n\n\n<p>Now we can see the data is displaying correctly and we can publish changes in GTM.<\/p>\n\n\n\n<p>The biggest benefit of passing parameters values is we can set up dynamic product remarketing. Where product id is required for dynamic remarketing.<\/p>\n\n\n\n<h2 class=\"wp-block-heading\"><strong>Conclusion<\/strong><\/h2>\n\n\n\n<p>DataLayer values are not only used for Facebook conversion tracking, this was just an example. The type of data displayed may vary but the same method is used for pulling data from datalayer.<\/p>\n\n\n\n<h3 class=\"wp-block-heading\"><strong>Related Articles:<\/strong><\/h3>\n\n\n\n<p><a href=\"https:\/\/marketlytics.com\/blog\/google-tag-manager-events-complete-guide\">How to Use Google Tag Manager for Event Tracking<\/a><\/p>\n\n\n\n<p><a href=\"https:\/\/marketlytics.com\/blog\/google-tag-manager-adwords-conversion-tracking\">Adwords Conversion Tracking Google Tag Manager<\/a><\/p>\n\n\n\n<p><a href=\"https:\/\/marketlytics.com\/blog\/google-tag-manager-adwords-conversion-tracking\">Improving Form Submission Tracking Google Tag Manager<\/a><\/p>\n\n\n\n<div class=\"poptin-embedded\" data-id=\"524d62d316aa4\">&nbsp;<\/div>\n","protected":false},"excerpt":{"rendered":"<p>Learn how to pull ecommerce data from datalayer in google tag manager and push into Facebook event pixel as parameter value or use for any other purpose like ecommerce tracking.&nbsp;<\/p>\n","protected":false},"author":5,"featured_media":10458,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"content-type":"","footnotes":""},"categories":[3,5],"tags":[49,56,66],"acf":[],"aioseo_notices":[],"_links":{"self":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/401"}],"collection":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/users\/5"}],"replies":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/comments?post=401"}],"version-history":[{"count":0,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/401\/revisions"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/media\/10458"}],"wp:attachment":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/media?parent=401"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/categories?post=401"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/tags?post=401"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}