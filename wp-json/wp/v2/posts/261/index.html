{"id":261,"date":"2017-04-11T13:23:50","date_gmt":"2017-04-11T08:23:50","guid":{"rendered":"http:\/\/18.139.242.7\/2017\/04\/11\/fun-with-big-query-and-r\/"},"modified":"2023-05-26T10:30:59","modified_gmt":"2023-05-26T10:30:59","slug":"fun-with-big-query-and-r","status":"publish","type":"post","link":"https:\/\/marketlytics.com\/blog\/fun-with-big-query-and-r\/","title":{"rendered":"Fun with BigQuery and R &#8211; Building a Google Analytics Alternate"},"content":{"rendered":"<p>As of a few weeks ago, I started getting my hands dirty with google BigQuery, that is an enterprise cloud data warehouse. (Keep reading if you need a little more info about the topic of discussion than already stated).<\/p>\n<p>ps. the last part is a joke, I love google analytics and not just for the fact that it\u2019s hard to replace and elegantly built but it was a fun thought experiment.<\/p>\n<p>During that period, I was asked to post data from google analytics to google BigQuery. As I got on with it, the first problem I faced was that google BigQuery accepts data, exported only from \u201cGoogle Analytics premium\u201d and doing so can be an obstacle for startups or low budget firms as it is quite expensive.<\/p>\n<p>So the only option left to consider here is third party applications. After a little bit of research, I stumbled upon this online <a target=\"_blank\" href=\"https:\/\/github.com\/MarkEdmondson1234\/ga-bq-stream\" rel=\"noopener noreferrer\">github repo by <\/a><a target=\"_blank\" href=\"https:\/\/github.com\/MarkEdmondson1234\/ga-bq-stream\" rel=\"noopener noreferrer\">Mark Edmondson<\/a>, which allows streaming tag manager data to BigQuery using a python app that moves the data received from GTM and transforms it into BigQuery schema. Naturally this is also running on google app engine \ud83d\ude42<\/p>\n<h2><strong>What is BigQuery?<\/strong><\/h2>\n<p>Think about large sets of data. By large, I mean few PBs and TBs of which that not just need managing, but interpreting, analyzing, manipulating as well as storing. All these big words put together form a deadly combination which is enough to send any analytics newbie running towards the hills.<\/p>\n<p>If that is not enough, imagine querying your way through massive datasets, minus the expensive hardware setup that makes the job easier and automated.<\/p>\n<p>When it comes to data analytics, you are going to need to do all that and more. This is where BigQuery comes in, a fast, hassle free alternative for analytics rookies &#8211; combined with the power of Google\u2019s robust infrastructure.<\/p>\n<p>The best thing about BigQuery as a RESTFUL web service would be its low price offering, bundled with a fully managed substructure that offers advanced query processing and that too on huge chunks of data.<\/p>\n<p><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/236_image-asset.png\" alt=\" big query data flow \"><\/p>\n<p>For integration of third party tools with Google BigQuery (in this case a python app), there are a few simple steps you need to attempt:<\/p>\n<h2><strong>Getting and Streaming Data:<\/strong><\/h2>\n<p>First you need a google cloud account, as BigQuery is a part of &#8211; or associated with google cloud and it accesses google cloud project. After this is taken care of, you need to create the tables which is fairly easy in BigQuery. In case you need any further assistance. Please refer to the extensive documentation available on<a target=\"_blank\" href=\"https:\/\/cloud.google.com\/bigquery\/docs\/\" rel=\"noopener noreferrer\"> https:\/\/cloud.google.com\/bigquery\/docs\/<\/a> .<\/p>\n<p>The next important step is creating the schema.<\/p>\n<h2><strong>So what is schema?<\/strong><\/h2>\n<p>A Schema is basically the structure of a database. It includes database table names,columns. It can lodge and the type of data these fields will hold etc.<\/p>\n<p>This is extremely important as we have to be sure about the data we need. Here, what we needed was basic GTM values like clientId,page views and other related stuff. So essentially extracting information about our business needs while naming table columns is quite important because every time you want to alter a table schema, you\u2019d have to delete the table and recreate it. BigQuery does have the option to add field but only at the end of the table and that too can\u2019t be removed.<\/p>\n<p><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/237_image-asset.png\" alt=\" big query data table \"><\/p>\n<p>Next you need to make appropriate changes in the code and deploy the app to google cloud so that it can capture incoming data and pass it onto Google BigQuery. Since I was new to all this, I kind of got stuck at every point here. From setting up the SDK to making changes into YAML file and deploying it to the cloud app engine. After successfully deploying the app we had to actually send the data.<\/p>\n<h2><strong>Google Tag Manager to deliver the goods<\/strong><\/h2>\n<p>For collecting data and moving it to app engine, we made custom tags that will capture the data from our web site and stream it to BigQuery through our app.<\/p>\n<p>This is the part where I faced most the problems. Our data was sort of dynamic, as some events fire at a page and some not. Keeping it to GTM is fairly simple but we ran out of options &nbsp;when all these values are being stored in real time in a table. So deciding when to fire a certain tag, when to send certain data to BigQuery table or when to send a \u2018NULL\u2019 is also very important. Though this process wasn\u2019t really painless and as clumsy as a regular developer can be, I made a lot of common mistakes like missing out a variable. So, it&#8217;s quite normal if the process doesn\u2019t go as smoothly as you\u2019d reckon.<\/p>\n<p>Another problem with streaming was that I had to send all the values to all the fields. There were no defaults like if a field is missed it does not send NULL automatically. This also makes it necessary to know for sure what your schema will be before hand.<\/p>\n<p>After banging our heads against the wall and using google to its fullest we resolved our errors and the app was successfully deployed and started streaming our data to google BigQuery.<\/p>\n<h2><strong>R shiny:<\/strong><\/h2>\n<p>Next step was to visualize our data and to plot some sort of forecast for it. The best language to use for this purpose is R as it has over 7000 packages which deal with plotting, visualization and forecast.<\/p>\n<p><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/238_image-asset.png\" alt=\" realtime dashboard bigquery \"><\/p>\n<p>If I am being honest here we knew almost nothing about working with this \u2018alphabet\u2019 cum language.<\/p>\n<p>But there is a repo on github again by <a target=\"_blank\" href=\"https:\/\/github.com\/MarkEdmondson1234\/realtimeShiny\" rel=\"noopener noreferrer\">Mark Edmondson with R shiny app<\/a> for visualizing and forecasting google bigQuery data.<\/p>\n<p>First we tried to deploy the app to google cloud app engine but since it had only limited environments, we failed miserably in setting up a custom environment for our R shiny app.<\/p>\n<p>After making a few changes to shiny app code and running it locally, a few issues with google authorization came up at first but luckily they were resolved.<\/p>\n<p>Now the challenge at hand was querying and getting bigQuery fields. This problem was fairly silly because there is a check to see consistency in field names and used fields. Meaning we could only use the mentioned field in a variable. Querying anything less or more would generate an error and to be honest R errors are really weird and difficult to comprehend so it\u2019s something you\u2019d definitely want to avoid.<\/p>\n<p>In the end, we successfully deployed the app to shinyapps.io through Rstudio which is basically &nbsp;click and deploy. Although, we still wanted to make a few more changes but not having any luck, we decided to give it a rest. Basically what the app shows is the number of hits per timestamp and a forecast for next couple of hours.<\/p>\n<h2>How was it?<\/h2>\n<p>This was fairly new experience for me though, painful but fun to do. Exploring different techniques and tools is always the best way to discover something new and to augment your skills.<\/p>\n<p>Next time while working with something relatively new, I\u2019d definitely be bombarded with problems and bugs, but I\u2019ll make sure to share them with you along with a proper solution. Also a big thanks to Mark Edmondson who was very kind in answering what were surely to him noob questions.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Learn how to collect google analytics data and send to google big query using a third party tool. Included the required steps to move data successfully.&nbsp;<\/p>\n","protected":false},"author":5,"featured_media":263,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"content-type":"","footnotes":""},"categories":[3,156],"tags":[23,66],"acf":[],"aioseo_notices":[],"_links":{"self":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/261"}],"collection":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/users\/5"}],"replies":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/comments?post=261"}],"version-history":[{"count":0,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/261\/revisions"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/media\/263"}],"wp:attachment":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/media?parent=261"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/categories?post=261"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/tags?post=261"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}