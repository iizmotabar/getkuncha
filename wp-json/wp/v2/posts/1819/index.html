{"id":1819,"date":"2017-11-30T08:29:30","date_gmt":"2017-11-30T03:29:30","guid":{"rendered":"http:\/\/18.139.242.7\/uncategorized\/spam-referral-traffic-gtm\/"},"modified":"2017-11-30T08:29:30","modified_gmt":"2017-11-30T03:29:30","slug":"spam-referral-traffic-gtm","status":"publish","type":"post","link":"https:\/\/marketlytics.com\/analytics-faq\/spam-referral-traffic-gtm\/","title":{"rendered":"How to Remove Spam Referral Traffic from Facebook"},"content":{"rendered":"<p>So recently I noticed that installing Facebook Pixel via Google Tag Manager records spam traffic in ads manager. I didn\u2019t notice this until I saw the purchase pixel. It was displaying 24 purchases in the last 7 days but there was no actual purchase in the backend.<\/p>\n<h2><strong>How to view the referral URL in ads manager?<\/strong><\/h2>\n<p>To make sure your pixel data is accurate and there is no spam referral, open your ads manager and navigate to pixels. Select the active pixel. Scroll down to see the graph and click on activity from the graph navigation menu.<\/p>\n<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/click-activity.png\" alt=\" fb pixel activity analysis \"><\/p>\n<p>In the activity tab, click any event or pageview pixel. I clicked on the <strong>add to cart<\/strong> pixel to see the referral URL.<\/p>\n<p><img decoding=\"async\" class=\"aligncenter\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/add-to-cart-pixel.png\" alt=\" check referral url \"><\/p>\n<p>If you look at the referral URL, it is not the website URL, instead, it belongs to GTM. The referral URL is <strong>gtm-msr.appspot.com<\/strong><\/p>\n<p>This is really annoying and I believe you have never looked at this data until you check the purchase pixel. Because we can imagine that ok, people are visiting my website and they perform certain activities.<\/p>\n<h2><strong>How to block appspot referral in GTM?<\/strong><\/h2>\n<p>Now, how do we actually solve this issue? There is not a big thing to do, you only have to add a javascript code which will prevent the pixel code to fire when the referral equals to the appspot URL.<\/p>\n<p>You will have to add the below line of code to every pixel(base + event) you have added via GTM.<\/p>\n<p><strong>if((document.location.href.search(&#8216;<a href=\"https:\/\/appspot.com\/\">appspot.com<\/a>&#8216;)==-1)&amp;&amp;(document.referrer.search(&#8216;<a href=\"https:\/\/appspot.com\/\">appspot.com<\/a>&#8216;)==-1)){<\/strong><\/p>\n<p>pixel code here<\/p>\n<p><strong>}<\/strong><\/p>\n<p>Below is an example of how base and event pixel will be modified.<\/p>\n<p><strong>Base Pixel:<\/strong><\/p>\n<pre class=\"source-code\"><span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">script<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span>\n  <span class=\"cm-keyword\">if<\/span>((<span class=\"cm-variable\">document<\/span>.<span class=\"cm-property\">location<\/span>.<span class=\"cm-property\">href<\/span>.<span class=\"cm-property\">search<\/span>(<span class=\"cm-string\">'appspot.com'<\/span>)<span class=\"cm-operator\">==-<\/span><span class=\"cm-number\">1<\/span>)<span class=\"cm-operator\">&amp;&amp;<\/span>(<span class=\"cm-variable\">document<\/span>.<span class=\"cm-property\">referrer<\/span>.<span class=\"cm-property\">search<\/span>(<span class=\"cm-string\">'appspot.com'<\/span>)<span class=\"cm-operator\">==-<\/span><span class=\"cm-number\">1<\/span>)){\n\n<span class=\"cm-operator\">!<\/span><span class=\"cm-keyword\">function<\/span>(<span class=\"cm-def\">f<\/span>,<span class=\"cm-def\">b<\/span>,<span class=\"cm-def\">e<\/span>,<span class=\"cm-def\">v<\/span>,<span class=\"cm-def\">n<\/span>,<span class=\"cm-def\">t<\/span>,<span class=\"cm-def\">s<\/span>){<span class=\"cm-keyword\">if<\/span>(<span class=\"cm-variable-2\">f<\/span>.<span class=\"cm-property\">fbq<\/span>)<span class=\"cm-keyword\">return<\/span>;<span class=\"cm-variable-2\">n<\/span><span class=\"cm-operator\">=<\/span><span class=\"cm-variable-2\">f<\/span>.<span class=\"cm-property\">fbq<\/span><span class=\"cm-operator\">=<\/span><span class=\"cm-keyword\">function<\/span>(){<span class=\"cm-variable-2\">n<\/span>.<span class=\"cm-property\">callMethod<\/span><span class=\"cm-operator\">?<\/span>\n<span class=\"cm-variable-2\">n<\/span>.<span class=\"cm-property\">callMethod<\/span>.<span class=\"cm-property\">apply<\/span>(<span class=\"cm-variable-2\">n<\/span>,<span class=\"cm-variable-2\">arguments<\/span>):<span class=\"cm-variable-2\">n<\/span>.<span class=\"cm-property\">queue<\/span>.<span class=\"cm-property\">push<\/span>(<span class=\"cm-variable-2\">arguments<\/span>)};<span class=\"cm-keyword\">if<\/span>(<span class=\"cm-operator\">!<\/span><span class=\"cm-variable-2\">f<\/span>.<span class=\"cm-property\">_fbq<\/span>)<span class=\"cm-variable-2\">f<\/span>.<span class=\"cm-property\">_fbq<\/span><span class=\"cm-operator\">=<\/span><span class=\"cm-variable-2\">n<\/span>;\n<span class=\"cm-variable-2\">n<\/span>.<span class=\"cm-property\">push<\/span><span class=\"cm-operator\">=<\/span><span class=\"cm-variable-2\">n<\/span>;<span class=\"cm-variable-2\">n<\/span>.<span class=\"cm-property\">loaded<\/span><span class=\"cm-operator\">=!<\/span><span class=\"cm-number\">0<\/span>;<span class=\"cm-variable-2\">n<\/span>.<span class=\"cm-property\">version<\/span><span class=\"cm-operator\">=<\/span><span class=\"cm-string\">'2.0'<\/span>;<span class=\"cm-variable-2\">n<\/span>.<span class=\"cm-property\">queue<\/span><span class=\"cm-operator\">=<\/span>[];<span class=\"cm-variable-2\">t<\/span><span class=\"cm-operator\">=<\/span><span class=\"cm-variable-2\">b<\/span>.<span class=\"cm-property\">createElement<\/span>(<span class=\"cm-variable-2\">e<\/span>);<span class=\"cm-variable-2\">t<\/span>.<span class=\"cm-property\">async<\/span><span class=\"cm-operator\">=!<\/span><span class=\"cm-number\">0<\/span>;\n<span class=\"cm-variable-2\">t<\/span>.<span class=\"cm-property\">src<\/span><span class=\"cm-operator\">=<\/span><span class=\"cm-variable-2\">v<\/span>;<span class=\"cm-variable-2\">s<\/span><span class=\"cm-operator\">=<\/span><span class=\"cm-variable-2\">b<\/span>.<span class=\"cm-property\">getElementsByTagName<\/span>(<span class=\"cm-variable-2\">e<\/span>)[<span class=\"cm-number\">0<\/span>];<span class=\"cm-variable-2\">s<\/span>.<span class=\"cm-property\">parentNode<\/span>.<span class=\"cm-property\">insertBefore<\/span>(<span class=\"cm-variable-2\">t<\/span>,<span class=\"cm-variable-2\">s<\/span>)}(<span class=\"cm-variable\">window<\/span>,\n<span class=\"cm-variable\">document<\/span>,<span class=\"cm-string\">'script'<\/span>,<span class=\"cm-string\">'https:\/\/connect.facebook.net\/en_US\/fbevents.js'<\/span>);\n<span class=\"cm-variable\">fbq<\/span>(<span class=\"cm-string\">'init'<\/span>, <span class=\"cm-variable\">xxxxxxxxxxxxxxx<\/span>); <span class=\"cm-comment\">\/\/ Insert your pixel ID here.<\/span>\n<span class=\"cm-variable\">fbq<\/span>(<span class=\"cm-string\">'track'<\/span>, <span class=\"cm-string\">'PageView'<\/span>);\n  }\n<span class=\"cm-tag cm-bracket\">&lt;\/<\/span><span class=\"cm-tag\">script<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span>\n<span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">noscript<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span><span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">img<\/span> <span class=\"cm-attribute\">height<\/span>=<span class=\"cm-string\">\"1\"<\/span> <span class=\"cm-attribute\">width<\/span>=<span class=\"cm-string\">\"1\"<\/span> <span class=\"cm-attribute\">style<\/span>=<span class=\"cm-string\">\"display:none\"<\/span>\n<span class=\"cm-attribute\">src<\/span>=<span class=\"cm-string\">\"https:\/\/www.facebook.com\/tr?id=xxxxxxxxxxx&amp;ev=PageView&amp;noscript=1\"<\/span>\n<span class=\"cm-tag cm-bracket\">\/&gt;<\/span><span class=\"cm-tag cm-bracket\">&lt;\/<\/span><span class=\"cm-tag\">noscript<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span>\n<\/pre>\n<p><strong>Event code:<\/strong><\/p>\n<pre class=\"source-code\"><span class=\"cm-tag cm-bracket\">&lt;<\/span><span class=\"cm-tag\">script<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span>\n<span class=\"cm-keyword\">if<\/span>((<span class=\"cm-variable\">document<\/span>.<span class=\"cm-property\">location<\/span>.<span class=\"cm-property\">href<\/span>.<span class=\"cm-property\">search<\/span>(<span class=\"cm-string\">'appspot.com'<\/span>)<span class=\"cm-operator\">==-<\/span><span class=\"cm-number\">1<\/span>)<span class=\"cm-operator\">&amp;&amp;<\/span>(<span class=\"cm-variable\">document<\/span>.<span class=\"cm-property\">referrer<\/span>.<span class=\"cm-property\">search<\/span>(<span class=\"cm-string\">'appspot.com'<\/span>)<span class=\"cm-operator\">==-<\/span><span class=\"cm-number\">1<\/span>)){\n  \n    <span class=\"cm-variable\">fbq<\/span>(<span class=\"cm-string\">'track'<\/span>,<span class=\"cm-string\">'ViewContent'<\/span>,{\n        <span class=\"cm-property\">content_type<\/span>: <span class=\"cm-string\">'product'<\/span>,\n        <span class=\"cm-property\">content_ids<\/span>:<span class=\"cm-variable\">skuId<\/span>,\n        <span class=\"cm-property\">content_name<\/span>:<span class=\"cm-variable\">title<\/span>,\n        <span class=\"cm-property\">content_category<\/span>:<span class=\"cm-variable\">categories<\/span>,\n        <span class=\"cm-property\">value<\/span>:<span class=\"cm-variable\">price<\/span>,\n        <span class=\"cm-property\">currency<\/span>: <span class=\"cm-string\">'Rand'<\/span>\n    });\n}\n<span class=\"cm-tag cm-bracket\">&lt;\/<\/span><span class=\"cm-tag\">script<\/span><span class=\"cm-tag cm-bracket\">&gt;<\/span><\/pre>\n<p>Once you add this to all pixels, you will never have to see any referral traffic in ads manager and your data will be accurate. If you have questions regarding this topic, please ask us directly on <a href=\"https:\/\/twitter.com\/MarketLytics\">Twitter<\/a>.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Learn how to identify spam traffic in your ads manager account and block with a simple javascript code. If your purchase pixel is not matching the actual purchases, you would want to check this.&nbsp;<\/p>\n","protected":false},"author":5,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"content-type":"","footnotes":""},"categories":[2],"tags":[56,66],"acf":[],"aioseo_notices":[],"_links":{"self":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/1819"}],"collection":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/users\/5"}],"replies":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/comments?post=1819"}],"version-history":[{"count":0,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/1819\/revisions"}],"wp:attachment":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/media?parent=1819"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/categories?post=1819"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/tags?post=1819"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}