{"id":157,"date":"2014-07-23T16:35:14","date_gmt":"2014-07-23T11:35:14","guid":{"rendered":"http:\/\/18.139.242.7\/2014\/07\/23\/dom-scrapping-to-quickly-collect-data-in-tagmanager\/"},"modified":"2022-04-09T08:49:08","modified_gmt":"2022-04-09T08:49:08","slug":"dom-scrapping-to-quickly-collect-data-in-tagmanager","status":"publish","type":"post","link":"https:\/\/marketlytics.com\/blog\/dom-scrapping-to-quickly-collect-data-in-tagmanager\/","title":{"rendered":"How to Use DOM Scraping to Quickly Collect Data in Tag Manager"},"content":{"rendered":"<p><em>In this I&#8217;ll be discussing how I quickly test new changes using only google tag manager and custom html tags.<\/em> I have been a big proponent of dom scraping and using whats already on in the html of the page to collect data for analytics. One of the reasons I fell in love with google tag manager in its beta period was its custom html tag, that allowed for endless possibilities in terms of code you could execute.<\/p>\n<p>I have written about <a href=\"https:\/\/marketlytics.com\/blog\/building-datalayer-within-google-tag-manager-interface-using-jquery-javascript\">dom scraping using js \/ jquery last year<\/a>. And since then Google has also made scraping easier by providing Auto event listeners as well JavaScript macros, both of which can be used to extract element values and populate tags.<\/p>\n<p>GTM also offers the ability to test and preview changes in debug mode, allowing a developer to test any change on the live site without affecting customers. Combine this with an ability to scrap and mold the data, in the dom and we have the recipe for an addictive loop, providing instantaneous feedback to any changes we make.<\/p>\n<p>I am going to discuss how to use this approach to make deployment cycles short and sweet, as well as why to fight the urge to use this in production.<\/p>\n<p>Using the approach is straight forward, all you need is a custom html tag or a js macro which uses javascript or a lib like jquery to extract some data from the page and populates either an analytics tag or sends data to another custom html tag for manipulation.<\/p>\n<h2><strong>Structure<\/strong><\/h2>\n<p>When doing scraping it&#8217;s ideal to isolate the tags and not mix them with production tags. I use -test- on these tags to keep the visually separate.<\/p>\n<blockquote><p>A rule of thumb is a single tag should perform one function.<\/p><\/blockquote>\n<p>For scraping to be accurate we should only do scraping once the DOM has completed loading and we can be certain all elements are available. This can be done using a native gtm rule<\/p>\n<pre class=\"source-code\">{{<span class=\"cm-variable\">event<\/span>}} <span class=\"cm-variable\">equals<\/span> <span class=\"cm-variable\">gtm<\/span>.<span class=\"cm-property\">dom<\/span><\/pre>\n<p>You can use the standard dataLayer syntax to communicate with other tags and pass data. Just like you would on a normal page.<\/p>\n<p>For example if you are categorizing pages for Content Groups, one tag should do the extraction and then pass the data to another tag for sending to analytics service.<\/p>\n<pre class=\"source-code\"><span class=\"cm-operator\">&lt;<\/span><span class=\"cm-variable\">script<\/span><span class=\"cm-operator\">&gt;<\/span>\n<span class=\"cm-keyword\">function<\/span> <span class=\"cm-variable\">categorizePages<\/span>(<span class=\"cm-def\">pagePath<\/span>){\n    <span class=\"cm-comment\">\/\/ code to categorize<\/span>\n     \n    <span class=\"cm-comment\">\/\/ send the data to dataLayer<\/span>\n    <span class=\"cm-keyword\">return<\/span> <span class=\"cm-variable\">dataLayer<\/span>.<span class=\"cm-property\">push<\/span>({<span class=\"cm-string cm-property\">'contentGroup'<\/span>:<span class=\"cm-string\">'xyz'<\/span>, <span class=\"cm-string cm-property\">'event'<\/span>:<span class=\"cm-string\">'categorized'<\/span>}); \n});\n \n<span class=\"cm-variable\">categorizePages<\/span>(<span class=\"cm-string\">'{{url path}}'<\/span>); <span class=\"cm-comment\">\/\/ url path macro     <\/span>\n<span class=\"cm-operator\">&lt;<\/span><span class=\"cm-string-2\">\/script&gt;<\/span><\/pre>\n<p>Something like this can be triggered using a rule on every page<\/p>\n<blockquote><p>{{event}} equals gtm.dom<\/p><\/blockquote>\n<h2><strong>Firing order<\/strong><\/h2>\n<p>A thing to remember when using multiple tags that are dependent on each other is tag firing order. We can build chains to trigger tags by firing events with each dL push and using rules in the next tag to trigger based on the event of previous one.<\/p>\n<p>We can also use the Tag priority feature to prioritize which tags are triggered first.<\/p>\n<h2><strong>Library Dependency<\/strong><\/h2>\n<p>jQuery is a go to library for extraction, it is found on majority of sites and is a real time saver by enhancing capabilities of js code. If you are planning to use it make sure any code you trigger is done after the library has loaded. This can be done by triggering any tags dependent on this are executed after dom is ready using a rule<\/p>\n<blockquote><p>{{event}} equals gtm.dom<\/p><\/blockquote>\n<p><strong>Code &gt; Preview &gt; Repeat<\/strong><\/p>\n<p>Once you have your code, in order comes the fun part of deploying it on the live site and seeing the data roll in realtime.<\/p>\n<p>You can hit save on the <strong>tag &gt; click<\/strong> on preview and load the site.<\/p>\n<p>Didn&#8217;t come off as expected? No problem make a change and repeat.<\/p>\n<p>Need another person to check your data just send them a share link.<\/p>\n<p>Another approach I use it for is to prove value of data before doing a full scale deployment. With Google Analytics on feature tear and releasing cool things every month its tempting to want it all, using some gtm elbow grease allows for getting in to thick of it quickly. I generally do <strong>dom scraping<\/strong> setup an analytics tag with a test <strong>UA-code<\/strong> and let it run for a week. And then once we have the data it&#8217;s easier to make a case for its benefits.<\/p>\n<h2>Pro and Cons of using in Production<\/h2>\n<p>The ease of implementing things via dom can sometimes lead us to conclude everything should be done this way. But long term use of this approach can be harmful resulting in data loss. The main problem in DOM is a presentation layer and not meant for data collection, so a change to how data is presented would invariably lead to breaking tracking. Second since everything is done via gtm interface there is no indication to other team members that anything has changed.<\/p>\n<p>Stephane Hamel has a great post on benefits and dangers <a href=\"https:\/\/www.cardinalpath.com\/tms-data-layer-dom-scraping-pros-cons\/\" target=\"_blank\" rel=\"noopener noreferrer\">of dom scraping<\/a>&nbsp;you should check it out. To add to this I generally agree that,&nbsp;<strong>dom scraping<\/strong> should be used for quick prototyping and checking if the idea would work. As well as for short periods as a stop gap solution until the production code is ready.<\/p>\n<p>Only exception to this is old legacy systems where documentation is incomplete and code is not being updated and you have somehow convinced them to add GTM once. Here your only way forward would be to do some <strong>js magic<\/strong> to get the data you want and this would be the way to go.<\/p>\n<p>In a next post I will rundown how I deployed the entire enhanced ecommerce suite using this approach.<\/p>\n<p>What are some ideas you are testing?<\/p>\n<div class=\"poptin-embedded\" data-id=\"524d62d316aa4\"><\/div>\n","protected":false},"excerpt":{"rendered":"<p><span style=\"font-size:13px\">An easy to follow and quick guide about how I test new changes without interfering with site code using Google Tag manager and custom html tags. <\/span><\/p>\n","protected":false},"author":5,"featured_media":158,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"content-type":"","footnotes":""},"categories":[3],"tags":[40,45,66,85],"acf":[],"aioseo_notices":[],"_links":{"self":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/157"}],"collection":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/users\/5"}],"replies":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/comments?post=157"}],"version-history":[{"count":0,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/157\/revisions"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/media\/158"}],"wp:attachment":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/media?parent=157"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/categories?post=157"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/tags?post=157"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}