{"id":149,"date":"2014-10-28T09:01:12","date_gmt":"2014-10-28T04:01:12","guid":{"rendered":"http:\/\/18.139.242.7\/2014\/10\/28\/tag-manager-send-data-to-multiple-analytics-accounts\/"},"modified":"2014-10-28T09:01:12","modified_gmt":"2014-10-28T04:01:12","slug":"tag-manager-send-data-to-multiple-analytics-accounts","status":"publish","type":"post","link":"https:\/\/marketlytics.com\/blog\/tag-manager-send-data-to-multiple-analytics-accounts\/","title":{"rendered":"Fire a single analytics tag multiple times redux"},"content":{"rendered":"<p id=\"yui_3_17_2_1_1449214113063_192302\">Simo Ahva wrote a great post a couple of months ago in which he mentioned a way to trigger the same <a href=\"https:\/\/www.simoahava.com\/analytics\/fun-google-tag-manager-part-2\/#5\">analytics tag multiple times<\/a><\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192307\">The approach is an awesome clean way of reusing a single universal analytics tag and its <strong>hitCallback<\/strong> feature to send data to multiple tracking ids. I recently needed to use this method and discovered a few kinks to the original approach, which cause it to only work once per pageload and only for one tag at a time.<\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192313\">tldr; checkout the way to use same hitCallback multiple times per page <a href=\"https:\/\/marketlytics-ml.squarespace.com\/config#tldr\">here<\/a>.<\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192319\">Checkout the <a href=\"https:\/\/www.simoahava.com\/analytics\/fun-google-tag-manager-part-2\/#5\">post<\/a> and see if you can spot it (while you are at it read up on the other tricks outlined too :)).<\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192325\">The drawbacks I found:1- The method can only be used to trigger one tag multiple times per pageload. This is because the counter used is being set in the global scope and once it iterates its not reset. So you can only use it once. This is really on gtm since there is no other way to pass state in a good dynamic way.<\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192328\">2- The approach can only be used for one tag at a time. Since the rule to trigger is defined as event equals tagCallback only one tag can have this rule otherwise for every hitCallback all tags will be triggered. <\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192331\">Both of these are easy enough to fix (though it took me a lot longer \ud83d\ude41  hitCallback refusing to work when I was in debug mode, which is story for another time).<\/p>\n<h3 id=\"yui_3_17_2_1_1449214113063_192334\"><a href=\"\"><\/a>Here is what we need<\/h3>\n<h4 id=\"yui_3_17_2_1_1449214113063_192338\">Macros<\/h4>\n<p><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/img_5e62377f1b89e.png\" title=\"\" alt=\"GTM tag callback function.png\"\/><\/p>\n<p><strong>1- tag callback function<\/strong><\/p>\n<pre class=\"source-code\"><span class=\"cm-keyword\">function<\/span>(){\n    <span class=\"cm-keyword\">return<\/span> <span class=\"cm-keyword\">function<\/span>(){        \n        <span class=\"cm-keyword\">var<\/span> <span class=\"cm-def\">maxRepeat<\/span> <span class=\"cm-operator\">=<\/span> <span class=\"cm-number\">3<\/span>;\n        <span class=\"cm-variable\">window<\/span>.<span class=\"cm-property\">gtm_tag_counter<\/span> <span class=\"cm-operator\">=<\/span> <span class=\"cm-variable\">window<\/span>.<span class=\"cm-property\">gtm_tag_counter<\/span> <span class=\"cm-operator\">||<\/span> <span class=\"cm-number\">0<\/span>;\n        <span class=\"cm-keyword\">if<\/span>(<span class=\"cm-string\">\"{{event}}\"<\/span> <span class=\"cm-operator\">!=<\/span> <span class=\"cm-string\">\"tagCallback\"<\/span>){\n            <span class=\"cm-variable\">dataLayer<\/span>.<span class=\"cm-property\">push<\/span>({<span class=\"cm-string cm-property\">'chainStarter'<\/span>: <span class=\"cm-string\">'{{event}}'<\/span>});\n        }\n         \n        <span class=\"cm-keyword\">if<\/span> ( <span class=\"cm-variable\">window<\/span>.<span class=\"cm-property\">gtm_tag_counter<\/span> <span class=\"cm-operator\">&lt;<\/span> <span class=\"cm-variable-2\">maxRepeat<\/span><span class=\"cm-operator\">-<\/span><span class=\"cm-number\">1<\/span> ){\n             \n            <span class=\"cm-variable\">dataLayer<\/span>.<span class=\"cm-property\">push<\/span>({<span class=\"cm-string cm-property\">'event'<\/span> : <span class=\"cm-string\">'tagCallback'<\/span>});\n            <span class=\"cm-variable\">window<\/span>.<span class=\"cm-property\">gtm_tag_counter<\/span> <span class=\"cm-operator\">+=<\/span> <span class=\"cm-number\">1<\/span>;\n        } \n        <span class=\"cm-keyword\">else<\/span> {\n            <span class=\"cm-comment\">\/\/ delete gtm_tag_counter from global scope<\/span>\n            <span class=\"cm-keyword\">delete<\/span> <span class=\"cm-variable\">gtm_tag_counter<\/span>;\n            <span class=\"cm-variable\">dataLayer<\/span>.<span class=\"cm-property\">push<\/span>({<span class=\"cm-string cm-property\">'event'<\/span> : <span class=\"cm-string\">'allCalledOut'<\/span>}); \n            <span class=\"cm-comment\">\/\/ do something once all tags are done<\/span>\n        }\n    }\n}<\/pre>\n<p id=\"yui_3_17_2_1_1449476318882_62620\">In this code here is whats been changed. I have added an if statement that checks if the hitCallback is being triggered by the event tagCallback if it isn&#8217;t we store the event that got the ball rolling.<\/p>\n<p>Finally after the tag counter is maxed out I have added an else statement to delete the counter so its back to default value and also push an event that tells you the entire iteration is done and you are free to do any other actions.<\/p>\n<p><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/img_5e6237836aead.png\" title=\"\" alt=\"GTM chain starter.png\"\/><\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192364\"><strong>2- tag callback chain starter<\/strong><\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192368\">This is a macro to keep track of event that started the chain its used to make sure only specific tags associated with the starting event are triggered.<\/p>\n<p><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/img_5e6237861ffb8.png\" title=\"\" alt=\"GTM tag callback counter.png\"\/><\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192372\">3- tag callback counter\n<\/p>\n<p><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/img_5e62378911493.png\" title=\"\" alt=\"GTM tracker id.png\"\/><\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192376\"><strong>4- tracker id<\/strong><\/p>\n<p><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/img_5e62378bb7416.png\" title=\"\" alt=\"GTM tracker name.png\"\/><\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192381\"><strong>5- tracker name<\/strong><\/p>\n<h4 id=\"yui_3_17_2_1_1449214113063_192385\">In the analytics tags itself we need to:<\/h4>\n<p><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/img_5e62378e83bb0.png\" title=\"\" alt=\"GTM hitCallback.png\"\/><\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192389\"><em>1- set hitCallback<\/em><\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192393\">setting this as a field is where the magic happens.<\/p>\n<p><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/img_5e6237911de16.png\" title=\"\" alt=\"GTM multiple tracker rule.png\"\/><\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192397\"><strong>2- Rules<\/strong><\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192401\">Because we want to be specific we need to create a new rule for each tag that needs to use the callback approach, we define on which particular tagCallback events the tag should be triggered since this is pageload we want to trigger it when the chain starter (original event that called the callback) was gtm.js and event is tagCallback<\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192404\">So for any tag this would be<br \/>\n{{tag callback chain starter}}<em>equals<\/em>originalEvent{{event}}<em>equals<\/em>tagCallback<\/p>\n<p><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/img_5e6237936f987.png\" title=\"\" alt=\"GTM rules multiple tracker.png\"\/><\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192414\">Here is what it looks like\n<\/p>\n<p><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/img_5e623795da186.png\" title=\"\" alt=\"GTM tag tracker id.png\"\/><\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192418\"><strong>3- set tracker id<\/strong><\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192422\">set the UA code of the property where you&#8217;d want to send the data.<\/p>\n<p><img decoding=\"async\" src=\"https:\/\/marketlytics.com\/wp-content\/uploads\/2020\/03\/img_5e623798986ae.png\" title=\"\" alt=\"GTM tag tracker name.png\"\/><\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192426\"><strong>4- set tracker name<\/strong><\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192430\">This is optional gtm creates new trackers each time a tag is initiated but you can use it to control what these are named.<\/p>\n<p id=\"yui_3_17_2_1_1449214113063_192433\">And there we have it reusing the same tag with multiple trackers while reusing the same callback with multiple tags. Though its slightly more tricky with us requiring to add a new rule each time its more robust.<\/p>\n","protected":false},"excerpt":{"rendered":"<p><span style=\"font-size:13px\">An enhancement to Simo Ahva&#8217;s firing an analytics tag multiple times. Send all data to multiple google analytics accounts using a single Google Tag Manager tag.<\/span><\/p>\n","protected":false},"author":5,"featured_media":150,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"content-type":"","footnotes":""},"categories":[3],"tags":[66,68,85,108],"acf":[],"aioseo_notices":[],"_links":{"self":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/149"}],"collection":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/users\/5"}],"replies":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/comments?post=149"}],"version-history":[{"count":0,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/posts\/149\/revisions"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/media\/150"}],"wp:attachment":[{"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/media?parent=149"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/categories?post=149"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/marketlytics.com\/wp-json\/wp\/v2\/tags?post=149"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}